import{x as _,h as D,d as L,B as T,r as V,f as E}from"./chunk.vendor_entities.js";import{f as F}from"./chunk.vendor_domhandler.js";var a;(function(e){e[e.Tab=9]="Tab",e[e.NewLine=10]="NewLine",e[e.FormFeed=12]="FormFeed",e[e.CarriageReturn=13]="CarriageReturn",e[e.Space=32]="Space",e[e.ExclamationMark=33]="ExclamationMark",e[e.Number=35]="Number",e[e.Amp=38]="Amp",e[e.SingleQuote=39]="SingleQuote",e[e.DoubleQuote=34]="DoubleQuote",e[e.Dash=45]="Dash",e[e.Slash=47]="Slash",e[e.Zero=48]="Zero",e[e.Nine=57]="Nine",e[e.Semi=59]="Semi",e[e.Lt=60]="Lt",e[e.Eq=61]="Eq",e[e.Gt=62]="Gt",e[e.Questionmark=63]="Questionmark",e[e.UpperA=65]="UpperA",e[e.LowerA=97]="LowerA",e[e.UpperF=70]="UpperF",e[e.LowerF=102]="LowerF",e[e.UpperZ=90]="UpperZ",e[e.LowerZ=122]="LowerZ",e[e.LowerX=120]="LowerX",e[e.OpeningSquareBracket=91]="OpeningSquareBracket"})(a||(a={}));var i;(function(e){e[e.Text=1]="Text",e[e.BeforeTagName=2]="BeforeTagName",e[e.InTagName=3]="InTagName",e[e.InSelfClosingTag=4]="InSelfClosingTag",e[e.BeforeClosingTagName=5]="BeforeClosingTagName",e[e.InClosingTagName=6]="InClosingTagName",e[e.AfterClosingTagName=7]="AfterClosingTagName",e[e.BeforeAttributeName=8]="BeforeAttributeName",e[e.InAttributeName=9]="InAttributeName",e[e.AfterAttributeName=10]="AfterAttributeName",e[e.BeforeAttributeValue=11]="BeforeAttributeValue",e[e.InAttributeValueDq=12]="InAttributeValueDq",e[e.InAttributeValueSq=13]="InAttributeValueSq",e[e.InAttributeValueNq=14]="InAttributeValueNq",e[e.BeforeDeclaration=15]="BeforeDeclaration",e[e.InDeclaration=16]="InDeclaration",e[e.InProcessingInstruction=17]="InProcessingInstruction",e[e.BeforeComment=18]="BeforeComment",e[e.CDATASequence=19]="CDATASequence",e[e.InSpecialComment=20]="InSpecialComment",e[e.InCommentLike=21]="InCommentLike",e[e.BeforeSpecialS=22]="BeforeSpecialS",e[e.SpecialStartSequence=23]="SpecialStartSequence",e[e.InSpecialTag=24]="InSpecialTag",e[e.BeforeEntity=25]="BeforeEntity",e[e.BeforeNumericEntity=26]="BeforeNumericEntity",e[e.InNamedEntity=27]="InNamedEntity",e[e.InNumericEntity=28]="InNumericEntity",e[e.InHexEntity=29]="InHexEntity"})(i||(i={}));function b(e){return e===a.Space||e===a.NewLine||e===a.Tab||e===a.FormFeed||e===a.CarriageReturn}function S(e){return e===a.Slash||e===a.Gt||b(e)}function y(e){return e>=a.Zero&&e<=a.Nine}function U(e){return e>=a.LowerA&&e<=a.LowerZ||e>=a.UpperA&&e<=a.UpperZ}function G(e){return e>=a.UpperA&&e<=a.UpperF||e>=a.LowerA&&e<=a.LowerF}var d;(function(e){e[e.NoValue=0]="NoValue",e[e.Unquoted=1]="Unquoted",e[e.Single=2]="Single",e[e.Double=3]="Double"})(d||(d={}));const u={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])};class O{constructor({xmlMode:t=!1,decodeEntities:s=!0},n){this.cbs=n,this.state=i.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=i.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=t,this.decodeEntities=s,this.entityTrie=t?_:D}reset(){this.state=i.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=i.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(t){this.offset+=this.buffer.length,this.buffer=t,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}getIndex(){return this.index}getSectionStart(){return this.sectionStart}stateText(t){t===a.Lt||!this.decodeEntities&&this.fastForwardTo(a.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=i.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&t===a.Amp&&(this.state=i.BeforeEntity)}stateSpecialStartSequence(t){const s=this.sequenceIndex===this.currentSequence.length;if(!(s?S(t):(t|32)===this.currentSequence[this.sequenceIndex]))this.isSpecial=!1;else if(!s){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=i.InTagName,this.stateInTagName(t)}stateInSpecialTag(t){if(this.sequenceIndex===this.currentSequence.length){if(t===a.Gt||b(t)){const s=this.index-this.currentSequence.length;if(this.sectionStart<s){const n=this.index;this.index=s,this.cbs.ontext(this.sectionStart,s),this.index=n}this.isSpecial=!1,this.sectionStart=s+2,this.stateInClosingTagName(t);return}this.sequenceIndex=0}(t|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===u.TitleEnd?this.decodeEntities&&t===a.Amp&&(this.state=i.BeforeEntity):this.fastForwardTo(a.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(t===a.Lt)}stateCDATASequence(t){t===u.Cdata[this.sequenceIndex]?++this.sequenceIndex===u.Cdata.length&&(this.state=i.InCommentLike,this.currentSequence=u.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=i.InDeclaration,this.stateInDeclaration(t))}fastForwardTo(t){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===t)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(t){t===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===u.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=i.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):t!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(t){return this.xmlMode?!S(t):U(t)}startSpecial(t,s){this.isSpecial=!0,this.currentSequence=t,this.sequenceIndex=s,this.state=i.SpecialStartSequence}stateBeforeTagName(t){if(t===a.ExclamationMark)this.state=i.BeforeDeclaration,this.sectionStart=this.index+1;else if(t===a.Questionmark)this.state=i.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(t)){const s=t|32;this.sectionStart=this.index,!this.xmlMode&&s===u.TitleEnd[2]?this.startSpecial(u.TitleEnd,3):this.state=!this.xmlMode&&s===u.ScriptEnd[2]?i.BeforeSpecialS:i.InTagName}else t===a.Slash?this.state=i.BeforeClosingTagName:(this.state=i.Text,this.stateText(t))}stateInTagName(t){S(t)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateBeforeClosingTagName(t){b(t)||(t===a.Gt?this.state=i.Text:(this.state=this.isTagStartChar(t)?i.InClosingTagName:i.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(t){(t===a.Gt||b(t))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=i.AfterClosingTagName,this.stateAfterClosingTagName(t))}stateAfterClosingTagName(t){(t===a.Gt||this.fastForwardTo(a.Gt))&&(this.state=i.Text,this.baseState=i.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(t){t===a.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=i.InSpecialTag,this.sequenceIndex=0):this.state=i.Text,this.baseState=this.state,this.sectionStart=this.index+1):t===a.Slash?this.state=i.InSelfClosingTag:b(t)||(this.state=i.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(t){t===a.Gt?(this.cbs.onselfclosingtag(this.index),this.state=i.Text,this.baseState=i.Text,this.sectionStart=this.index+1,this.isSpecial=!1):b(t)||(this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateInAttributeName(t){(t===a.Eq||S(t))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=i.AfterAttributeName,this.stateAfterAttributeName(t))}stateAfterAttributeName(t){t===a.Eq?this.state=i.BeforeAttributeValue:t===a.Slash||t===a.Gt?(this.cbs.onattribend(d.NoValue,this.index),this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(t)):b(t)||(this.cbs.onattribend(d.NoValue,this.index),this.state=i.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(t){t===a.DoubleQuote?(this.state=i.InAttributeValueDq,this.sectionStart=this.index+1):t===a.SingleQuote?(this.state=i.InAttributeValueSq,this.sectionStart=this.index+1):b(t)||(this.sectionStart=this.index,this.state=i.InAttributeValueNq,this.stateInAttributeValueNoQuotes(t))}handleInAttributeValue(t,s){t===s||!this.decodeEntities&&this.fastForwardTo(s)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(s===a.DoubleQuote?d.Double:d.Single,this.index),this.state=i.BeforeAttributeName):this.decodeEntities&&t===a.Amp&&(this.baseState=this.state,this.state=i.BeforeEntity)}stateInAttributeValueDoubleQuotes(t){this.handleInAttributeValue(t,a.DoubleQuote)}stateInAttributeValueSingleQuotes(t){this.handleInAttributeValue(t,a.SingleQuote)}stateInAttributeValueNoQuotes(t){b(t)||t===a.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(d.Unquoted,this.index),this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(t)):this.decodeEntities&&t===a.Amp&&(this.baseState=this.state,this.state=i.BeforeEntity)}stateBeforeDeclaration(t){t===a.OpeningSquareBracket?(this.state=i.CDATASequence,this.sequenceIndex=0):this.state=t===a.Dash?i.BeforeComment:i.InDeclaration}stateInDeclaration(t){(t===a.Gt||this.fastForwardTo(a.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=i.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(t){(t===a.Gt||this.fastForwardTo(a.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=i.Text,this.sectionStart=this.index+1)}stateBeforeComment(t){t===a.Dash?(this.state=i.InCommentLike,this.currentSequence=u.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=i.InDeclaration}stateInSpecialComment(t){(t===a.Gt||this.fastForwardTo(a.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=i.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(t){const s=t|32;s===u.ScriptEnd[3]?this.startSpecial(u.ScriptEnd,4):s===u.StyleEnd[3]?this.startSpecial(u.StyleEnd,4):(this.state=i.InTagName,this.stateInTagName(t))}stateBeforeEntity(t){this.entityExcess=1,this.entityResult=0,t===a.Number?this.state=i.BeforeNumericEntity:t===a.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=i.InNamedEntity,this.stateInNamedEntity(t))}stateInNamedEntity(t){if(this.entityExcess+=1,this.trieIndex=L(this.entityTrie,this.trieCurrent,this.trieIndex+1,t),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];const s=this.trieCurrent&T.VALUE_LENGTH;if(s){const n=(s>>14)-1;if(!this.allowLegacyEntity()&&t!==a.Semi)this.trieIndex+=n;else{const r=this.index-this.entityExcess+1;r>this.sectionStart&&this.emitPartial(this.sectionStart,r),this.entityResult=this.trieIndex,this.trieIndex+=n,this.entityExcess=0,this.sectionStart=this.index+1,n===0&&this.emitNamedEntity()}}}emitNamedEntity(){if(this.state=this.baseState,this.entityResult===0)return;switch((this.entityTrie[this.entityResult]&T.VALUE_LENGTH)>>14){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~T.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}stateBeforeNumericEntity(t){(t|32)===a.LowerX?(this.entityExcess++,this.state=i.InHexEntity):(this.state=i.InNumericEntity,this.stateInNumericEntity(t))}emitNumericEntity(t){const s=this.index-this.entityExcess-1;s+2+ +(this.state===i.InHexEntity)!==this.index&&(s>this.sectionStart&&this.emitPartial(this.sectionStart,s),this.sectionStart=this.index+Number(t),this.emitCodePoint(V(this.entityResult))),this.state=this.baseState}stateInNumericEntity(t){t===a.Semi?this.emitNumericEntity(!0):y(t)?(this.entityResult=this.entityResult*10+(t-a.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}stateInHexEntity(t){t===a.Semi?this.emitNumericEntity(!0):y(t)?(this.entityResult=this.entityResult*16+(t-a.Zero),this.entityExcess++):G(t)?(this.entityResult=this.entityResult*16+((t|32)-a.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}allowLegacyEntity(){return!this.xmlMode&&(this.baseState===i.Text||this.baseState===i.InSpecialTag)}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===i.Text||this.state===i.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===i.InAttributeValueDq||this.state===i.InAttributeValueSq||this.state===i.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const t=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case i.Text:{this.stateText(t);break}case i.SpecialStartSequence:{this.stateSpecialStartSequence(t);break}case i.InSpecialTag:{this.stateInSpecialTag(t);break}case i.CDATASequence:{this.stateCDATASequence(t);break}case i.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(t);break}case i.InAttributeName:{this.stateInAttributeName(t);break}case i.InCommentLike:{this.stateInCommentLike(t);break}case i.InSpecialComment:{this.stateInSpecialComment(t);break}case i.BeforeAttributeName:{this.stateBeforeAttributeName(t);break}case i.InTagName:{this.stateInTagName(t);break}case i.InClosingTagName:{this.stateInClosingTagName(t);break}case i.BeforeTagName:{this.stateBeforeTagName(t);break}case i.AfterAttributeName:{this.stateAfterAttributeName(t);break}case i.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(t);break}case i.BeforeAttributeValue:{this.stateBeforeAttributeValue(t);break}case i.BeforeClosingTagName:{this.stateBeforeClosingTagName(t);break}case i.AfterClosingTagName:{this.stateAfterClosingTagName(t);break}case i.BeforeSpecialS:{this.stateBeforeSpecialS(t);break}case i.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(t);break}case i.InSelfClosingTag:{this.stateInSelfClosingTag(t);break}case i.InDeclaration:{this.stateInDeclaration(t);break}case i.BeforeDeclaration:{this.stateBeforeDeclaration(t);break}case i.BeforeComment:{this.stateBeforeComment(t);break}case i.InProcessingInstruction:{this.stateInProcessingInstruction(t);break}case i.InNamedEntity:{this.stateInNamedEntity(t);break}case i.BeforeEntity:{this.stateBeforeEntity(t);break}case i.InHexEntity:{this.stateInHexEntity(t);break}case i.InNumericEntity:{this.stateInNumericEntity(t);break}default:this.stateBeforeNumericEntity(t)}this.index++}this.cleanup()}finish(){this.state===i.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const t=this.buffer.length+this.offset;this.state===i.InCommentLike?this.currentSequence===u.CdataEnd?this.cbs.oncdata(this.sectionStart,t,0):this.cbs.oncomment(this.sectionStart,t,0):this.state===i.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===i.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===i.InTagName||this.state===i.BeforeAttributeName||this.state===i.BeforeAttributeValue||this.state===i.AfterAttributeName||this.state===i.InAttributeName||this.state===i.InAttributeValueSq||this.state===i.InAttributeValueDq||this.state===i.InAttributeValueNq||this.state===i.InClosingTagName||this.cbs.ontext(this.sectionStart,t)}emitPartial(t,s){this.baseState!==i.Text&&this.baseState!==i.InSpecialTag?this.cbs.onattribdata(t,s):this.cbs.ontext(t,s)}emitCodePoint(t){this.baseState!==i.Text&&this.baseState!==i.InSpecialTag?this.cbs.onattribentity(t):this.cbs.ontextentity(t)}}const I=new Set(["input","option","optgroup","select","button","datalist","textarea"]),h=new Set(["p"]),w=new Set(["thead","tbody"]),q=new Set(["dd","dt"]),k=new Set(["rt","rp"]),P=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",h],["h1",h],["h2",h],["h3",h],["h4",h],["h5",h],["h6",h],["select",I],["input",I],["output",I],["button",I],["datalist",I],["textarea",I],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",q],["dt",q],["address",h],["article",h],["aside",h],["blockquote",h],["details",h],["div",h],["dl",h],["fieldset",h],["figcaption",h],["figure",h],["footer",h],["form",h],["header",h],["hr",h],["main",h],["nav",h],["ol",h],["pre",h],["section",h],["table",h],["ul",h],["rt",k],["rp",k],["tbody",w],["tfoot",w]]),R=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),v=new Set(["math","svg"]),B=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),M=/\s|\//;class z{constructor(t,s={}){var n,r,o,c,l;this.options=s,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=t??{},this.lowerCaseTagNames=(n=s.lowerCaseTags)!==null&&n!==void 0?n:!s.xmlMode,this.lowerCaseAttributeNames=(r=s.lowerCaseAttributeNames)!==null&&r!==void 0?r:!s.xmlMode,this.tokenizer=new((o=s.Tokenizer)!==null&&o!==void 0?o:O)(this.options,this),(l=(c=this.cbs).onparserinit)===null||l===void 0||l.call(c,this)}ontext(t,s){var n,r;const o=this.getSlice(t,s);this.endIndex=s-1,(r=(n=this.cbs).ontext)===null||r===void 0||r.call(n,o),this.startIndex=s}ontextentity(t){var s,n;const r=this.tokenizer.getSectionStart();this.endIndex=r-1,(n=(s=this.cbs).ontext)===null||n===void 0||n.call(s,E(t)),this.startIndex=r}isVoidElement(t){return!this.options.xmlMode&&R.has(t)}onopentagname(t,s){this.endIndex=s;let n=this.getSlice(t,s);this.lowerCaseTagNames&&(n=n.toLowerCase()),this.emitOpenTag(n)}emitOpenTag(t){var s,n,r,o;this.openTagStart=this.startIndex,this.tagname=t;const c=!this.options.xmlMode&&P.get(t);if(c)for(;this.stack.length>0&&c.has(this.stack[this.stack.length-1]);){const l=this.stack.pop();(n=(s=this.cbs).onclosetag)===null||n===void 0||n.call(s,l,!0)}this.isVoidElement(t)||(this.stack.push(t),v.has(t)?this.foreignContext.push(!0):B.has(t)&&this.foreignContext.push(!1)),(o=(r=this.cbs).onopentagname)===null||o===void 0||o.call(r,t),this.cbs.onopentag&&(this.attribs={})}endOpenTag(t){var s,n;this.startIndex=this.openTagStart,this.attribs&&((n=(s=this.cbs).onopentag)===null||n===void 0||n.call(s,this.tagname,this.attribs,t),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(t){this.endIndex=t,this.endOpenTag(!1),this.startIndex=t+1}onclosetag(t,s){var n,r,o,c,l,m;this.endIndex=s;let f=this.getSlice(t,s);if(this.lowerCaseTagNames&&(f=f.toLowerCase()),(v.has(f)||B.has(f))&&this.foreignContext.pop(),this.isVoidElement(f))!this.options.xmlMode&&f==="br"&&((r=(n=this.cbs).onopentagname)===null||r===void 0||r.call(n,"br"),(c=(o=this.cbs).onopentag)===null||c===void 0||c.call(o,"br",{},!0),(m=(l=this.cbs).onclosetag)===null||m===void 0||m.call(l,"br",!1));else{const x=this.stack.lastIndexOf(f);if(x!==-1)if(this.cbs.onclosetag){let g=this.stack.length-x;for(;g--;)this.cbs.onclosetag(this.stack.pop(),g!==0)}else this.stack.length=x;else!this.options.xmlMode&&f==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=s+1}onselfclosingtag(t){this.endIndex=t,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=t+1):this.onopentagend(t)}closeCurrentTag(t){var s,n;const r=this.tagname;this.endOpenTag(t),this.stack[this.stack.length-1]===r&&((n=(s=this.cbs).onclosetag)===null||n===void 0||n.call(s,r,!t),this.stack.pop())}onattribname(t,s){this.startIndex=t;const n=this.getSlice(t,s);this.attribname=this.lowerCaseAttributeNames?n.toLowerCase():n}onattribdata(t,s){this.attribvalue+=this.getSlice(t,s)}onattribentity(t){this.attribvalue+=E(t)}onattribend(t,s){var n,r;this.endIndex=s,(r=(n=this.cbs).onattribute)===null||r===void 0||r.call(n,this.attribname,this.attribvalue,t===d.Double?'"':t===d.Single?"'":t===d.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(t){const s=t.search(M);let n=s<0?t:t.substr(0,s);return this.lowerCaseTagNames&&(n=n.toLowerCase()),n}ondeclaration(t,s){this.endIndex=s;const n=this.getSlice(t,s);if(this.cbs.onprocessinginstruction){const r=this.getInstructionName(n);this.cbs.onprocessinginstruction(`!${r}`,`!${n}`)}this.startIndex=s+1}onprocessinginstruction(t,s){this.endIndex=s;const n=this.getSlice(t,s);if(this.cbs.onprocessinginstruction){const r=this.getInstructionName(n);this.cbs.onprocessinginstruction(`?${r}`,`?${n}`)}this.startIndex=s+1}oncomment(t,s,n){var r,o,c,l;this.endIndex=s,(o=(r=this.cbs).oncomment)===null||o===void 0||o.call(r,this.getSlice(t,s-n)),(l=(c=this.cbs).oncommentend)===null||l===void 0||l.call(c),this.startIndex=s+1}oncdata(t,s,n){var r,o,c,l,m,f,x,g,N,p;this.endIndex=s;const A=this.getSlice(t,s-n);this.options.xmlMode||this.options.recognizeCDATA?((o=(r=this.cbs).oncdatastart)===null||o===void 0||o.call(r),(l=(c=this.cbs).ontext)===null||l===void 0||l.call(c,A),(f=(m=this.cbs).oncdataend)===null||f===void 0||f.call(m)):((g=(x=this.cbs).oncomment)===null||g===void 0||g.call(x,`[CDATA[${A}]]`),(p=(N=this.cbs).oncommentend)===null||p===void 0||p.call(N)),this.startIndex=s+1}onend(){var t,s;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let n=this.stack.length;n>0;this.cbs.onclosetag(this.stack[--n],!0));}(s=(t=this.cbs).onend)===null||s===void 0||s.call(t)}reset(){var t,s,n,r;(s=(t=this.cbs).onreset)===null||s===void 0||s.call(t),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(r=(n=this.cbs).onparserinit)===null||r===void 0||r.call(n,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(t){this.reset(),this.end(t)}getSlice(t,s){for(;t-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let n=this.buffers[0].slice(t-this.bufferOffset,s-this.bufferOffset);for(;s-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),n+=this.buffers[0].slice(0,s-this.bufferOffset);return n}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(t){var s,n;if(this.ended){(n=(s=this.cbs).onerror)===null||n===void 0||n.call(s,new Error(".write() after done!"));return}this.buffers.push(t),this.tokenizer.running&&(this.tokenizer.write(t),this.writeIndex++)}end(t){var s,n;if(this.ended){(n=(s=this.cbs).onerror)===null||n===void 0||n.call(s,new Error(".end() after done!"));return}t&&this.write(t),this.ended=!0,this.tokenizer.end()}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(t){this.write(t)}done(t){this.end(t)}}function C(e,t){const s=new F(void 0,t);return new z(s,t).end(e),s.root}export{C as p};
