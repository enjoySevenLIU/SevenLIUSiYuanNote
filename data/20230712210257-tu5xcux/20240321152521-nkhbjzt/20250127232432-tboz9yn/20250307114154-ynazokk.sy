{"ID":"20250307114154-ynazokk","Spec":"1","Type":"NodeDocument","Properties":{"id":"20250307114154-ynazokk","title":"US5L14——表面着色器实现动态液体","type":"doc","updated":"20250307132146"},"Children":[{"ID":"20250307114154-x9eddus","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20250307114154-x9eddus","updated":"20250307125347"},"Children":[{"Type":"NodeText","Data":"动态液体效果"}]},{"ID":"20250307114333-amfm5v8","Type":"NodeParagraph","Properties":{"id":"20250307114333-amfm5v8","updated":"20250307114426"},"Children":[{"Type":"NodeText","Data":"在游戏开发中，动态液体效果就是"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"用 Shader 模拟出透明容器装透明液体的效果"},{"Type":"NodeText","Data":"\n这种效果常用与游戏和动画中，比如用于制作玻璃瓶装液体的效果"}]},{"ID":"20250307114400-rspvz11","Type":"NodeParagraph","Properties":{"id":"20250307114400-rspvz11","updated":"20250307114415"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"style":"width: 331px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20250307114400-vyd3b3k.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 331px;\"}"},{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20250307114415-gffsdzz.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20250307114420-cyqli2u","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250307114420-cyqli2u","updated":"20250307125347"},"Children":[{"Type":"NodeText","Data":"动态液体效果的基本原理"}]},{"ID":"20250307114452-lhhg511","Type":"NodeParagraph","Properties":{"id":"20250307114452-lhhg511","updated":"20250307114506"},"Children":[{"Type":"NodeText","Data":"一句话概括它的基本原理："},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"动态液体效果是通过透明渲染、像素剔除、波纹效果模拟来实现的。"},{"Type":"NodeText","Data":"其中的关键点为："}]},{"ID":"20250307114508-nd5nj9y","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20250307114508-nd5nj9y","updated":"20250307125347"},"Children":[{"ID":"20250307114512-up0w7qk","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20250307114512-up0w7qk","updated":"20250307114512"},"Children":[{"ID":"20250307114512-bnt1i0j","Type":"NodeParagraph","Properties":{"id":"20250307114512-bnt1i0j","updated":"20250307114530"},"Children":[{"Type":"NodeText","Data":"如何被容器装载"}]},{"ID":"20250307114531-1ujhxm6","Type":"NodeParagraph","Properties":{"id":"20250307114531-1ujhxm6","updated":"20250307114628"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"用两个模型，一个容器模型，一个液体模型，液体模型其实和容器模型一模一样，只是稍小一些，\n让这两个模型使用不同的材质。容器使用透明材质，液体使用动态液体材质即可"}]}]},{"ID":"20250307114512-efj0x42","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20250307114512-efj0x42","updated":"20250307114512"},"Children":[{"ID":"20250307114512-4dyanwa","Type":"NodeParagraph","Properties":{"id":"20250307114512-4dyanwa","updated":"20250307114512"},"Children":[{"Type":"NodeText","Data":"如何透明渲染"}]},{"ID":"20250307114630-21ykqcz","Type":"NodeParagraph","Properties":{"id":"20250307114630-21ykqcz","updated":"20250307114650"},"Children":[{"Type":"NodeText","Data":"在表面着色器中实现透明渲染，和顶点/片元着色器的透明度混合基本一致，\n"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"只需要通过设置渲染类型、队列、混合模式、关闭深度写入即可"}]},{"ID":"20250307114652-4zuro1s","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250307114652-4zuro1s","updated":"20250307114840"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"Tags { \"RenderType\"=\"Transparent\" \"Queue\"=\"Transparent\" }\t// 设置渲染类型和队列为透明\nBlend DstColor SrcColor\t\t\t\t\t\t\t\t\t\t// 设置混合模式\nZWrite Off\t\t\t\t\t\t\t\t\t\t\t\t\t// 为了实现透明，关闭深度写入\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20250307114512-d5hsn5m","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20250307114512-d5hsn5m","updated":"20250307114512"},"Children":[{"ID":"20250307114512-1sq3pu1","Type":"NodeParagraph","Properties":{"id":"20250307114512-1sq3pu1","updated":"20250307114512"},"Children":[{"Type":"NodeText","Data":"如何剔除像素"}]},{"ID":"20250307114902-9tu5lbo","Type":"NodeParagraph","Properties":{"id":"20250307114902-9tu5lbo","updated":"20250307115829"},"Children":[{"Type":"NodeText","Data":"我们将模型空间中心点作为参考点，将其转换到世界空间下，再用模型当前世界空间下的点和它进行减法运算。\n如果判断点在参考点上方的我们便对其进行剔除，这时我们可以加入自定义变量控制液面高度 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_Level"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20250307114916-djfh3un","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250307114916-djfh3un","updated":"20250307115653"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"aGxzbA=="},{"Type":"NodeCodeBlockCode","Data":"// 液面效果\nfloat3 pivot = mul(unity_ObjectToWorld, float4(0, 0, 0, 1));    // 将物体的模型空间的中心点坐标(0,0,0)转换到对应的世界空间下坐标，用它来判断裁剪\nfloat liquid = pivot.y - IN.worldPos.y + _Level * 0.01;\t        // 计算液体表面相对于当前点的高度差，_Level是控制液面高低的参数\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250307115213-3ojw9gf","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250307115213-3ojw9gf","updated":"20250307115351"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"aGxzbA=="},{"Type":"NodeCodeBlockCode","Data":"// 像素剔除\nliquid = step(0, liquid);\t// 若liuqid \u003e= 0，则返回1，否则返回0，控制liuqid为正数\nclip(liquid - 0.001);\t\t// 若liuqid - 0.001 \u003c 0，就裁剪掉此像素不渲染\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20250307114512-uzfqi9l","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20250307114512-uzfqi9l","updated":"20250307125347"},"Children":[{"ID":"20250307114512-ansj192","Type":"NodeParagraph","Properties":{"id":"20250307114512-ansj192","updated":"20250307114512"},"Children":[{"Type":"NodeText","Data":"如何模拟波纹效果"}]},{"ID":"20250307115951-e3y2xjy","Type":"NodeParagraph","Properties":{"id":"20250307115951-e3y2xjy","updated":"20250307120003"},"Children":[{"Type":"NodeText","Data":"我们可以利用之前学习的流动的河流的相关公式来计算波纹效果，具体详见："},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20241225002416-nj2owy8","TextMarkBlockRefSubtype":"d","TextMarkTextContent":"US3S9L4——顶点波动效果——流动的河流"},{"Type":"NodeText","Data":"\n即："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"纵轴位置的偏移量 = sin( _Time.y * 波动频率 + 顶点在横轴上的坐标 * 波长的倒数) * 波动幅度"},{"Type":"NodeText","Data":"​"}]},{"ID":"20250307120029-9f80acg","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250307120029-9f80acg","updated":"20250307125347"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"aGxzbA=="},{"Type":"NodeCodeBlockCode","Data":"// 波纹效果\nfloat ripple = sin(_Time.y * _WaveFrequency + IN.worldPos.x * _InvWaveLength) * _WaveAmplitude;\nliquid += ripple;\n// 像素剔除\nliquid = step(0, liquid);\t// 若liuqid \u003e= 0，则返回1，否则返回0，控制liuqid为正数\nclip(liquid - 0.001);\t\t// 若liuqid - 0.001 \u003c 0，就裁剪掉此像素不渲染，-0.001 是确保为liuqid为0时，像素一定被剔除\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20250307114516-9c2fmj7","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250307114516-9c2fmj7","updated":"20250307132146"},"Children":[{"Type":"NodeText","Data":"动态液体效果 具体实现"}]},{"ID":"20250307123439-rg52957","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20250307123439-rg52957","updated":"20250307123455"},"Children":[{"ID":"20250307123455-fio04dd","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20250307123455-fio04dd","updated":"20250307123455"},"Children":[{"ID":"20250307123455-690fz67","Type":"NodeParagraph","Properties":{"id":"20250307123455-690fz67","updated":"20250307123503"},"Children":[{"Type":"NodeText","Data":"新建表面着色器 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"DynamicLiquid"},{"Type":"NodeText","Data":"​（动态液体）"}]}]},{"ID":"20250307123455-29hzi3a","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20250307123455-29hzi3a","updated":"20250307123455"},"Children":[{"ID":"20250307123455-w9z5to7","Type":"NodeParagraph","Properties":{"id":"20250307123455-w9z5to7","updated":"20250307123455"},"Children":[{"Type":"NodeText","Data":"删除不必要的代码"}]}]},{"ID":"20250307123455-yv82i4p","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20250307123455-yv82i4p","updated":"20250307123455"},"Children":[{"ID":"20250307123455-1j2x7f0","Type":"NodeParagraph","Properties":{"id":"20250307123455-1j2x7f0","updated":"20250307123455"},"Children":[{"Type":"NodeText","Data":"声明属性以及属性映射\n"}]},{"ID":"20250307123507-mbe4kqm","Type":"NodeList","ListData":{},"Properties":{"id":"20250307123507-mbe4kqm","updated":"20250307123508"},"Children":[{"ID":"20250307123508-o6na6yi","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250307123508-o6na6yi","updated":"20250307123508"},"Children":[{"ID":"20250307123508-2833ins","Type":"NodeParagraph","Properties":{"id":"20250307123508-2833ins","updated":"20250307123541"},"Children":[{"Type":"NodeText","Data":"液体颜色 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_Color"},{"Type":"NodeText","Data":"​\n"}]}]},{"ID":"20250307123509-arsvumx","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250307123509-arsvumx","updated":"20250307123509"},"Children":[{"ID":"20250307123509-pf86ku8","Type":"NodeParagraph","Properties":{"id":"20250307123509-pf86ku8","updated":"20250307123538"},"Children":[{"Type":"NodeText","Data":"高光颜色和光滑度（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"rgb"},{"Type":"NodeText","Data":"​做颜色，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a"},{"Type":"NodeText","Data":"​ 做光滑度）"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_Specular"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20250307123510-0dh1iuy","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250307123510-0dh1iuy","updated":"20250307123510"},"Children":[{"ID":"20250307123510-ee5st49","Type":"NodeParagraph","Properties":{"id":"20250307123510-ee5st49","updated":"20250307123544"},"Children":[{"Type":"NodeText","Data":"液体高度 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_Height"},{"Type":"NodeText","Data":"​\n"}]}]},{"ID":"20250307123511-9et7nyo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250307123511-9et7nyo","updated":"20250307123511"},"Children":[{"ID":"20250307123511-ddodnqb","Type":"NodeParagraph","Properties":{"id":"20250307123511-ddodnqb","updated":"20250307123546"},"Children":[{"Type":"NodeText","Data":"波纹变化速度 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_Speed"},{"Type":"NodeText","Data":"​\n"}]}]},{"ID":"20250307123512-mvvss60","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250307123512-mvvss60","updated":"20250307123512"},"Children":[{"ID":"20250307123512-jv36z41","Type":"NodeParagraph","Properties":{"id":"20250307123512-jv36z41","updated":"20250307123557"},"Children":[{"Type":"NodeText","Data":"波动幅度 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_WaveAmplitude"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20250307123512-0sp1s67","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250307123512-0sp1s67","updated":"20250307123512"},"Children":[{"ID":"20250307123512-6w5kwjp","Type":"NodeParagraph","Properties":{"id":"20250307123512-6w5kwjp","updated":"20250307123556"},"Children":[{"Type":"NodeText","Data":"波动频率 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_WaveFrequency"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20250307123513-xk4nb9y","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250307123513-xk4nb9y","updated":"20250307123513"},"Children":[{"ID":"20250307123513-ftl4k79","Type":"NodeParagraph","Properties":{"id":"20250307123513-ftl4k79","updated":"20250307123553"},"Children":[{"Type":"NodeText","Data":"波长的倒数 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_InvWaveLength"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20250307124244-ya7cz4v","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250307124244-ya7cz4v","updated":"20250307124251"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"Properties\n{\n    _Color(\"Color\", Color) = (1, 1, 1, 1)       // 液体颜色\n    _Specular(\"Specular\", Color) = (0, 0, 0, 0) // 高光颜色(rgb)和光滑度(a)\n    _Height(\"Height\", Float) = 0                // 液体高度\n    _Speed(\"Speed\", Float) = 1                  // 波纹变化速度\n    _WaveAmplitude(\"WaveAmplitude\", Float) = 1  // 波动幅度\n    _WaveFrequecy(\"WaveFrequecy\", Float) = 1    // 波动频率\n    _InvWaveLength(\"InvWaveLength\", Float) = 1  // 波长倒数\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20250307123455-u17he63","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20250307123455-u17he63","updated":"20250307123455"},"Children":[{"ID":"20250307123455-3dvmmi1","Type":"NodeParagraph","Properties":{"id":"20250307123455-3dvmmi1","updated":"20250307131905"},"Children":[{"Type":"NodeText","Data":"透明混合相关设置，最好启用双面渲染"}]},{"ID":"20250307124543-5b5pl4f","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250307124543-5b5pl4f","updated":"20250307131856"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"Tags { \"RenderType\"=\"Transparent\" \"Queue\"=\"Transparent\" }   // 设置渲染类型和渲染队列为透明\nBlend DstColor SrcColor                                     // 混合相关设置\nZWrite Off                                                  // 关闭深度写入\nCull Off                                                    // 关闭剔除，双面渲染\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20250307123455-kjweur9","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NS4=","Num":5},"Properties":{"id":"20250307123455-kjweur9","updated":"20250307123455"},"Children":[{"ID":"20250307123455-9zqjtxu","Type":"NodeParagraph","Properties":{"id":"20250307123455-9zqjtxu","updated":"20250307123455"},"Children":[{"Type":"NodeText","Data":"编译指令设置\n"}]},{"ID":"20250307124549-ij6po5b","Type":"NodeParagraph","Properties":{"id":"20250307124549-ij6po5b","updated":"20250307124806"},"Children":[{"Type":"NodeText","Data":"光照模型我们使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"StandardSpecular"},{"Type":"NodeText","Data":"​，并且不要阴影 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"noshadow"},{"Type":"NodeText","Data":"​，同时 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"surf"},{"Type":"NodeText","Data":"​ 函数输出结构体参数改为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SurfaceOutputStandardSpecular"},{"Type":"NodeText","Data":"​"}]},{"ID":"20250307124606-3zv5cwe","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250307124606-3zv5cwe","updated":"20250307124819"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"#pragma surface surf StandardSpecular noshadow\n#pragma target 3.0\n\nvoid surf (Input IN, inout SurfaceOutputStandardSpecular o) { }\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20250307123455-3k9osgn","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Ni4=","Num":6},"Properties":{"id":"20250307123455-3k9osgn","updated":"20250307123455"},"Children":[{"ID":"20250307123455-vj91nwa","Type":"NodeParagraph","Properties":{"id":"20250307123455-vj91nwa","updated":"20250307123455"},"Children":[{"Type":"NodeText","Data":"输入结构体\n"}]},{"ID":"20250307124653-wu7j79w","Type":"NodeParagraph","Properties":{"id":"20250307124653-wu7j79w","updated":"20250307124653"},"Children":[{"Type":"NodeText","Data":"只需要当前像素的世界坐标位置"}]},{"ID":"20250307124655-m12n3er","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250307124655-m12n3er","updated":"20250307124828"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"struct Input\n{\n    float3 worldPos;    // 世界空间下像素点的位置\n};\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20250307123455-gguu2hw","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Ny4=","Num":7},"Properties":{"id":"20250307123455-gguu2hw","updated":"20250307123455"},"Children":[{"ID":"20250307123455-bvyy8bw","Type":"NodeParagraph","Properties":{"id":"20250307123455-bvyy8bw","updated":"20250307123455"},"Children":[{"Type":"NodeText","Data":"实现表面函数\n"}]},{"ID":"20250307124835-7at2kx0","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20250307124835-7at2kx0","updated":"20250307124851"},"Children":[{"ID":"20250307124851-ym7w1qs","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20250307124851-ym7w1qs","updated":"20250307124851"},"Children":[{"ID":"20250307124851-y62v1m5","Type":"NodeParagraph","Properties":{"id":"20250307124851-y62v1m5","updated":"20250307124851"},"Children":[{"Type":"NodeText","Data":"模型中心点转世界坐标"}]}]},{"ID":"20250307124851-sxsg70m","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20250307124851-sxsg70m","updated":"20250307124851"},"Children":[{"ID":"20250307124851-e76r14v","Type":"NodeParagraph","Properties":{"id":"20250307124851-e76r14v","updated":"20250307124854"},"Children":[{"Type":"NodeText","Data":"计算中心点和像素点 y 轴坐标差"}]}]},{"ID":"20250307124851-bminflx","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20250307124851-bminflx","updated":"20250307124851"},"Children":[{"ID":"20250307124851-ux9c9f1","Type":"NodeParagraph","Properties":{"id":"20250307124851-ux9c9f1","updated":"20250307124851"},"Children":[{"Type":"NodeText","Data":"像素剔除"}]}]},{"ID":"20250307124851-kz7ien1","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20250307124851-kz7ien1","updated":"20250307124851"},"Children":[{"ID":"20250307124851-gmqrxi5","Type":"NodeParagraph","Properties":{"id":"20250307124851-gmqrxi5","updated":"20250307124851"},"Children":[{"Type":"NodeText","Data":"波纹效果偏移计算"}]}]},{"ID":"20250307124851-ky5u53s","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NS4=","Num":5},"Properties":{"id":"20250307124851-ky5u53s","updated":"20250307124851"},"Children":[{"ID":"20250307124851-tf1y6fj","Type":"NodeParagraph","Properties":{"id":"20250307124851-tf1y6fj","updated":"20250307132122"},"Children":[{"Type":"NodeText","Data":"漫反射颜色、高光颜色、光滑度设置（因为这里只是单纯的颜色rgb通道混合，因此不需要设置透明度）"}]}]}]},{"ID":"20250307124857-2mts9y0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250307124857-2mts9y0","updated":"20250307132027"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"void surf (Input IN, inout SurfaceOutputStandardSpecular o)\n{\n    // 计算此像素与液面的高度差\n    float3 centerPoint = mul(unity_ObjectToWorld, float4(0, 0, 0, 1));      // 将模型空间下中心点转换到世界空间下\n    float liquidHeight = centerPoint.t - IN.worldPos.y + _Height * 0.01;    // 当前像素点和中心点的高度差\n    // 计算液面波纹偏移\n    float waveOffset = sin(_Time.y * _WaveFrequecy + IN.worldPos.x * _InvWaveLength) * _WaveAmplitude;\n    liuqidHeight += waveOffset;\n    // 若此像素的高度差小于0，则剔除（step返回0，再减去0.001确保此像素必定被剔除），否则就继续渲染\n    liquidHeight = step(0, liquidHeight);\n    clip(liuqidHeight - 0.001);\n\n    o.Albedo = _Color.rgb;      // 漫反射颜色\n    o.Specular = _Specular.rgb; // 高光颜色\n    o.Smoothness = _Specular.a; // 光滑度\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20250307132126-8s11n49","Type":"NodeParagraph","Properties":{"id":"20250307132126-8s11n49","updated":"20250307132132"},"Children":[{"Type":"NodeText","Data":"完整 Shader 代码如下："}]},{"ID":"20250307132132-z2barj5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250307132132-z2barj5","updated":"20250307132146"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"Shader \"TeachShader/DynamicLiquid\"\n{\n    Properties\n    {\n        _Color(\"Color\", Color) = (1, 1, 1, 1)           // 液体颜色\n        _Specular(\"Specular\", Color) = (0, 0, 0, 0)     // 高光颜色(rgb)和光滑度(a)\n        _Height(\"Height\", Float) = 0                    // 液体高度\n        _Speed(\"Speed\", Float) = 1                      // 波纹变化速度\n        _WaveAmplitude(\"WaveAmplitude\", Float) = 0.1    // 波动幅度\n        _WaveFrequecy(\"WaveFrequecy\", Float) = 0.5      // 波动频率\n        _InvWaveLength(\"InvWaveLength\", Float) = 1      // 波长倒数\n    }\n    SubShader\n    {\n        Tags { \"RenderType\"=\"Transparent\" \"Queue\"=\"Transparent\" }   // 设置渲染类型和渲染队列为透明\n        Blend DstColor SrcColor                                     // 混合相关设置\n        ZWrite Off                                                  // 关闭深度写入\n        Cull Off                                                    // 关闭剔除，双面渲染\n\n        CGPROGRAM\n        #pragma surface surf StandardSpecular noshadow\n        #pragma target 3.0\n\n        fixed4 _Color;\n        fixed4 _Specular;\n        float _Height;\n        float _Speed;\n        float _WaveAmplitude;\n        float _WaveFrequecy;\n        float _InvWaveLength;\n\n        struct Input\n        {\n            float3 worldPos;    // 世界空间下像素点的位置\n        };\n\n        void surf (Input IN, inout SurfaceOutputStandardSpecular o)\n        {\n            // 计算此像素与液面的高度差\n            float3 centerPoint = mul(unity_ObjectToWorld, float4(0, 0, 0, 1));      // 将模型空间下中心点转换到世界空间下\n            float liquidHeight = centerPoint.y - IN.worldPos.y + _Height * 0.01;    // 当前像素点和中心点的高度差\n            // 计算液面波纹偏移\n            float waveOffset = sin(_Time.y * _WaveFrequecy + IN.worldPos.x * _InvWaveLength) * _WaveAmplitude;\n            liquidHeight += waveOffset;\n            // 若此像素的高度差小于0，则剔除（step返回0，再减去0.001确保此像素必定被剔除），否则就继续渲染\n            liquidHeight = step(0, liquidHeight);\n            clip(liquidHeight - 0.001);\n\n            o.Albedo = _Color.rgb;      // 漫反射颜色\n            o.Specular = _Specular.rgb; // 高光颜色\n            o.Smoothness = _Specular.a; // 光滑度\n        }\n        ENDCG\n    }\n    FallBack \"Diffuse\"\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250307130234-ogu9kj7","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250307130234-ogu9kj7","updated":"20250307132124"},"Children":[{"Type":"NodeText","Data":"动态液体效果 的使用"}]},{"ID":"20250307130243-eofktsr","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20250307130243-eofktsr","updated":"20250307131948"},"Children":[{"ID":"20250307130245-w85okc5","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20250307130245-w85okc5","updated":"20250307130245"},"Children":[{"ID":"20250307130245-lquu33z","Type":"NodeParagraph","Properties":{"id":"20250307130245-lquu33z","updated":"20250307130245"},"Children":[{"Type":"NodeText","Data":"创建两个胶囊体,一大一小，小的做为大的子对象"}]}]},{"ID":"20250307130245-13xx4uw","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20250307130245-13xx4uw","updated":"20250307130245"},"Children":[{"ID":"20250307130245-egibgs6","Type":"NodeParagraph","Properties":{"id":"20250307130245-egibgs6","updated":"20250307130753"},"Children":[{"Type":"NodeText","Data":"大的胶囊体，用 Unity 自带 Shader 设置为透明的，并设置光滑度为1，类似玻璃容器"}]},{"ID":"20250307130737-ckvq11p","Type":"NodeParagraph","Properties":{"id":"20250307130737-ckvq11p","updated":"20250307130737"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20250307130737-wwzpy6j.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20250307130245-jesn5lc","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20250307130245-jesn5lc","updated":"20250307131948"},"Children":[{"ID":"20250307130245-i6upuyz","Type":"NodeParagraph","Properties":{"id":"20250307130245-i6upuyz","updated":"20250307130245"},"Children":[{"Type":"NodeText","Data":"小的胶囊体，用动态液体效果制作为容器中的液体"}]},{"ID":"20250307131948-q471r2d","Type":"NodeParagraph","Properties":{"id":"20250307131948-q471r2d","updated":"20250307131948"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20250307131948-tg9l80u.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20250307130302-xb9nfgr","Type":"NodeParagraph","Properties":{"id":"20250307130302-xb9nfgr","updated":"20250307131827"},"Children":[{"Type":"NodeText","Data":"显示效果："}]},{"ID":"20250307132005-qzslh7z","Type":"NodeParagraph","Properties":{"id":"20250307132005-qzslh7z","updated":"20250307132005"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"style":"width: 212px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20250307132005-r2fahbr.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 212px;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20250307132124-su64m7g","Type":"NodeParagraph","Properties":{"id":"20250307132124-su64m7g","updated":"20250307132124"}}]}