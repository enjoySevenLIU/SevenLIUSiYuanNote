{"ID":"20250302204340-qsp38h2","Spec":"1","Type":"NodeDocument","Properties":{"id":"20250302204340-qsp38h2","title":"US5L13——表面着色器实现顶点膨胀","type":"doc","updated":"20250307114028"},"Children":[{"ID":"20250302204340-2xtu3i6","Type":"NodeBlockquote","Properties":{"id":"20250302204340-2xtu3i6","updated":"20250302205158"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20250302204401-27amwy3","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250302204401-27amwy3","updated":"20250302205158"},"Children":[{"Type":"NodeText","Data":"表面着色器中处理顶点的方法"}]},{"ID":"20250302204408-dcjzwfv","Type":"NodeParagraph","Properties":{"id":"20250302204408-dcjzwfv","updated":"20250302205158"},"Children":[{"Type":"NodeText","Data":"在编译指令中："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#pragma surface 表面函数名 光照模型 可选额外参数"},{"Type":"NodeText","Data":"​\n可选额外参数中添加："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"vertex:自定义函数名"},{"Type":"NodeText","Data":"​\n函数格式："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"void 自定义函数名(inout appdata_full v)"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20250302204437-u1xhd52","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250302204437-u1xhd52","updated":"20250302210654"},"Children":[{"Type":"NodeText","Data":"实现顶点膨胀效果"}]},{"ID":"20250302205031-h1utxtu","Type":"NodeParagraph","Properties":{"id":"20250302205031-h1utxtu","updated":"20250302205145"},"Children":[{"Type":"NodeText","Data":"直接复用之前表面着色器使用发现贴图的代码，在此基础上进行修改，代码详见："},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20250228061724-i3f5q9d","TextMarkBlockRefSubtype":"d","TextMarkTextContent":"US5L12——表面着色器使用法线贴图"}]},{"ID":"20250302205145-jyzy31r","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20250302205145-jyzy31r","updated":"20250302205145"},"Children":[{"ID":"20250302205145-0cbremg","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20250302205145-0cbremg","updated":"20250302205145"},"Children":[{"ID":"20250302205145-k7mszl3","Type":"NodeParagraph","Properties":{"id":"20250302205145-k7mszl3","updated":"20250302205145"},"Children":[{"Type":"NodeText","Data":"加入顶点碰撞控制参数"}]},{"ID":"20250302205728-obv1498","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250302205728-obv1498","style":"line-height: 22px;","updated":"20250302205738"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"Properties\n{\n    _Color(\"Color\", Color) = (1, 1, 1, 1)\n    _MainTex(\"Albedo (RGB)\", 2D) = \"white\"{}\n    _BumpMap(\"BumpMap\", 2D) = \"\"{}\n    _Emission(\"Emission\", Color) = (0, 0, 0, 0)     // 自发光\n    _Metallic(\"Metallic\", Range(0, 1)) = 0          // 金属度\n    _Smoothness(\"Smoothness\", Range(0, 1)) = 0      // 光滑度\n    _Expansion(\"Expansion\", Float) = 0              // 顶点膨胀程度\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20250302205145-j27mik1","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20250302205145-j27mik1","updated":"20250302205145"},"Children":[{"ID":"20250302205145-fdmmvzd","Type":"NodeParagraph","Properties":{"id":"20250302205145-fdmmvzd","updated":"20250302205145"},"Children":[{"Type":"NodeText","Data":"在编译指令中加入顶点处理函数"}]},{"ID":"20250302205740-nuyivjs","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250302205740-nuyivjs","style":"line-height: 22px;","updated":"20250302205747"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"#pragma surface surf Standard fullforwardshadows vertex:vert\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20250302205145-mlzfpdb","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20250302205145-mlzfpdb","updated":"20250302205145"},"Children":[{"ID":"20250302205145-dt6rtw5","Type":"NodeParagraph","Properties":{"id":"20250302205145-dt6rtw5","updated":"20250302205145"},"Children":[{"Type":"NodeText","Data":"自定义顶点处理函数"}]}]},{"ID":"20250302205145-bdeo9sc","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20250302205145-bdeo9sc","updated":"20250302205145"},"Children":[{"ID":"20250302205145-rxelyet","Type":"NodeParagraph","Properties":{"id":"20250302205145-rxelyet","updated":"20250302205758"},"Children":[{"Type":"NodeText","Data":"在自定义顶点处理函数中对顶点进行偏移"}]},{"ID":"20250302205752-wpkc919","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250302205752-wpkc919","style":"line-height: 22px;","updated":"20250302205804"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"void vert(inout appdata_full v)\n{\n    // 让顶点坐标沿其发现方向向外扩充\n    v.vertex.xyz += v.normal * _Expansion;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20250302205806-tquvpsd","Type":"NodeParagraph","Properties":{"id":"20250302205806-tquvpsd","updated":"20250302205812"},"Children":[{"Type":"NodeText","Data":"完整 Shader 代码如下："}]},{"ID":"20250302205813-6lzd0t4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250302205813-6lzd0t4","style":"line-height: 22px;","updated":"20250302210654"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"Shader \"TeachShader/Lesson140\"\n{\n    Properties\n    {\n        _Color(\"Color\", Color) = (1, 1, 1, 1)\n        _MainTex(\"Albedo (RGB)\", 2D) = \"white\"{}\n        _BumpMap(\"BumpMap\", 2D) = \"\"{}\n        _Emission(\"Emission\", Color) = (0, 0, 0, 0)     // 自发光\n        _Metallic(\"Metallic\", Range(0, 1)) = 0          // 金属度\n        _Smoothness(\"Smoothness\", Range(0, 1)) = 0      // 光滑度\n        _Expansion(\"Expansion\", Float) = 0              // 顶点膨胀程度\n    }\n    SubShader\n    {\n        Tags { \"RenderType\"=\"Opaque\" }\n\n        CGPROGRAM\n        #pragma surface surf Standard fullforwardshadows vertex:vert\n        #pragma target 3.0\n\n        fixed4 _Color;\n        sampler2D _MainTex;\n        sampler2D _BumpMap;\n        fixed4 _Emission;\n        fixed _Metallic;\n        fixed _Smoothness;\n        float _Expansion;       // 顶点膨胀程度\n\n        struct Input\n        {\n            float2 uv_MainTex;\n            float2 uv_BumpMap;\n        };\n\n        void vert(inout appdata_full v)\n        {\n            // 让顶点坐标沿其发现方向向外扩充\n            v.vertex.xyz += v.normal * _Expansion;\n        }\n\n        void surf (Input IN, inout SurfaceOutputStandard o)\n        {\n            fixed4 texColor = tex2D(_MainTex, IN.uv_MainTex);\n            o.Albedo = texColor.rgb;                                    // 漫反射颜色\n            o.Alpha = texColor.a * _Color.a;                            // 透明度\n            o.Normal = UnpackNormal(tex2D(_BumpMap, IN.uv_BumpMap));    // 得到切线空间下的法线\n            o.Emission = _Emission.rgb;                                 // 自发光颜色\n            o.Metallic = _Metallic;                                     // 金属度\n            o.Smoothness = _Smoothness;                                 // 光滑度\n        }\n        \n        ENDCG\n    }\n    FallBack \"Diffuse\"\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250302205820-i3lvasb","Type":"NodeParagraph","Properties":{"id":"20250302205820-i3lvasb","updated":"20250302205856"},"Children":[{"Type":"NodeText","Data":"显示效果（膨胀程度0.4）："}]},{"ID":"20250302205916-flixp9y","Type":"NodeParagraph","Properties":{"id":"20250302205916-flixp9y","updated":"20250302205916"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20250302205916-68efw5v.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20250302205926-ffql3yo","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250302205926-ffql3yo","updated":"20250307114028"},"Children":[{"Type":"NodeText","Data":"表面着色器使用最终颜色处理函数"}]},{"ID":"20250302205936-h9gqljf","Type":"NodeParagraph","Properties":{"id":"20250302205936-h9gqljf","updated":"20250302210331"},"Children":[{"Type":"NodeText","Data":"可选额外参数中添加："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"finalcolor:自定义函数名"},{"Type":"NodeText","Data":"​，\n即可自定义最终颜色处理函数，函数格式为："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"void 自定义函数名(Input IN, SurfaceOutput... o, inout fixed4 color)"},{"Type":"NodeText","Data":"​\n其中，第二个参数的结构体类型与表面函数的第二个参数的结构体类型一致"}]},{"ID":"20250302210331-fms9ezl","Type":"NodeParagraph","Properties":{"id":"20250302210331-fms9ezl","updated":"20250302210551"},"Children":[{"Type":"NodeText","Data":"假设要让外部属性 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Color"},{"Type":"NodeText","Data":"​ 叠加在最终颜色上："}]},{"ID":"20250302210552-folbde3","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250302210552-folbde3","style":"line-height: 22px;","updated":"20250302210921"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"#pragma surface surf Standard fullforwardshadows vertex:vert finalcolor:finalColorProcess\n#pragma target 3.0\n\nfixed4 _Color;\n\nvoid finalColorProcess(Input IN, SurfaceOutputStandard o, inout fixed4 color)\n{\n    // 将颜色叠加到最终颜色上\n    color *= _Color;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250302210700-0ji4qzk","Type":"NodeParagraph","Properties":{"id":"20250302210700-0ji4qzk","updated":"20250302210947"},"Children":[{"Type":"NodeText","Data":"显示效果（叠加红色）："}]},{"ID":"20250302210957-qiozs9e","Type":"NodeParagraph","Properties":{"id":"20250302210957-qiozs9e","updated":"20250302210957"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"style":"width: 319px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20250302210957-pni6qvx.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 319px;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20250302211003-ufne865","Type":"NodeParagraph","Properties":{"id":"20250302211003-ufne865","updated":"20250302211009"},"Children":[{"Type":"NodeText","Data":"完整 Shader 代码如下："}]},{"ID":"20250302211009-nb0kiy2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250302211009-nb0kiy2","style":"line-height: 22px;","updated":"20250302211015"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"Shader \"TeachShader/Lesson140\"\n{\n    Properties\n    {\n        _Color(\"Color\", Color) = (1, 1, 1, 1)\n        _MainTex(\"Albedo (RGB)\", 2D) = \"white\"{}\n        _BumpMap(\"BumpMap\", 2D) = \"\"{}\n        _Emission(\"Emission\", Color) = (0, 0, 0, 0)     // 自发光\n        _Metallic(\"Metallic\", Range(0, 1)) = 0          // 金属度\n        _Smoothness(\"Smoothness\", Range(0, 1)) = 0      // 光滑度\n        _Expansion(\"Expansion\", Float) = 0              // 顶点膨胀程度\n    }\n    SubShader\n    {\n        Tags { \"RenderType\"=\"Opaque\" }\n\n        CGPROGRAM\n        #pragma surface surf Standard fullforwardshadows vertex:vert finalcolor:finalColorProcess\n        #pragma target 3.0\n\n        fixed4 _Color;\n        sampler2D _MainTex;\n        sampler2D _BumpMap;\n        fixed4 _Emission;\n        fixed _Metallic;\n        fixed _Smoothness;\n        float _Expansion;       // 顶点膨胀程度\n\n        struct Input\n        {\n            float2 uv_MainTex;\n            float2 uv_BumpMap;\n        };\n\n        void vert(inout appdata_full v)\n        {\n            // 让顶点坐标沿其发现方向向外扩充\n            v.vertex.xyz += v.normal * _Expansion;\n        }\n\n        void surf (Input IN, inout SurfaceOutputStandard o)\n        {\n            fixed4 texColor = tex2D(_MainTex, IN.uv_MainTex);\n            o.Albedo = texColor.rgb;                                    // 漫反射颜色\n            o.Alpha = texColor.a * _Color.a;                            // 透明度\n            o.Normal = UnpackNormal(tex2D(_BumpMap, IN.uv_BumpMap));    // 得到切线空间下的法线\n            o.Emission = _Emission.rgb;                                 // 自发光颜色\n            o.Metallic = _Metallic;                                     // 金属度\n            o.Smoothness = _Smoothness;                                 // 光滑度\n        }\n\n        void finalColorProcess(Input IN, SurfaceOutputStandard o, inout fixed4 color)\n        {\n            // 将外部属性颜色叠加到最终颜色上\n            color *= _Color;\n        }\n\n        ENDCG\n    }\n    FallBack \"Diffuse\"\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250307114028-hzeommi","Type":"NodeParagraph","Properties":{"id":"20250307114028-hzeommi","updated":"20250307114028"}}]}