{"ID":"20240510141454-1sm72s1","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240510141454-1sm72s1","title":"US1L2——渲染管线-应用阶段","type":"doc","updated":"20250220131328"},"Children":[{"ID":"20240510141455-wu51yew","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240510141455-wu51yew","updated":"20250220131215"},"Children":[{"Type":"NodeText","Data":"知识必备——CPU和GPU"}]},{"ID":"20240510141526-3qy5hwn","Type":"NodeList","ListData":{},"Properties":{"id":"20240510141526-3qy5hwn","updated":"20250220131215"},"Children":[{"ID":"20240510141531-ykh8jcc","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240510141531-ykh8jcc","updated":"20250220131212"},"Children":[{"ID":"20240510141531-i1t6oet","Type":"NodeParagraph","Properties":{"id":"20240510141531-i1t6oet","updated":"20240510141714"},"Children":[{"Type":"NodeText","Data":"CPU：中央处理器，负责算数运算、逻辑操作、数据传输等通用计算任务，同时还管理和调度计算机的资源\n"}]},{"ID":"20250220131153-gmpj4dh","Type":"NodeParagraph","Properties":{"id":"20250220131153-gmpj4dh","updated":"20250220131212"},"Children":[{"Type":"NodeText","Data":"（在游戏开发中 — CPU 就主要负责游戏逻辑处理，如角色移动，动画切换，寻路等等）"}]}]},{"ID":"20240510141532-d8q4tfw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240510141532-d8q4tfw","updated":"20250220131215"},"Children":[{"ID":"20240510141532-1h0k10q","Type":"NodeParagraph","Properties":{"id":"20240510141532-1h0k10q","updated":"20240510141728"},"Children":[{"Type":"NodeText","Data":"GPU：图形处理器，是专门用于图形和并行计算的处理器\n"}]},{"ID":"20250220131138-o6tvsek","Type":"NodeParagraph","Properties":{"id":"20250220131138-o6tvsek","updated":"20250220131215"},"Children":[{"Type":"NodeText","Data":"显卡就是搭载 GPU 的硬件设备，显卡包含一个或多个GPU芯片，还包含显存（用于存储图像数据）、显示接口、视频解码器等等\n（在游戏开发中 — GPU 负责将画面渲染相关处理）"}]}]}]},{"ID":"20240510141529-dhauifm","Type":"NodeParagraph","Properties":{"id":"20240510141529-dhauifm","updated":"20250220131201"},"Children":[{"Type":"NodeText","Data":"简单来说：CPU 主要处理操作系统管理、程序执行、通用计算等等，而 GPU 主要处理图形渲染、图像处理等等"}]},{"ID":"20240510141557-p9jasno","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240510141557-p9jasno","updated":"20250220131257"},"Children":[{"Type":"NodeText","Data":"渲染管线的应用阶段"}]},{"ID":"20240510141915-ma9k0l8","Type":"NodeParagraph","Properties":{"id":"20240510141915-ma9k0l8","updated":"20240510144722"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"width: 749px;","style":"width: 739px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240510141915-qt6ki6a.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 739px;\" parent-style=\"width: 749px;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240510141738-g2con2e","Type":"NodeParagraph","Properties":{"id":"20240510141738-g2con2e","updated":"20240510144722"},"Children":[{"Type":"NodeText","Data":"渲染管线的应用阶段中大部分的内容都和渲染无关（比如：游戏逻辑处理、动画更新、物理模拟、场景管理等等）\n当应用阶段完成后，后面的几何阶段以及光栅化阶段将开始处理和图形渲染相关的数据和操作。"}]},{"ID":"20240510141819-wsvon5d","Type":"NodeParagraph","Properties":{"id":"20240510141819-wsvon5d","updated":"20250220131225"},"Children":[{"Type":"NodeText","Data":"那么应用阶段为什么会归纳到渲染管线中呢？\n那是因为应用阶段为渲染管线的后续提供了最重要的内容 —— "},{"Type":"NodeTextMark","TextMarkType":"strong u","TextMarkTextContent":"数据"},{"Type":"NodeText","Data":"\n"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"应用阶段主导者是 CPU"},{"Type":"NodeText","Data":"，在这一阶段，我们"},{"Type":"NodeTextMark","TextMarkType":"strong u","TextMarkTextContent":"将渲染需要用到的数据传递给 GPU 用于后续的两个阶段的处理"}]},{"ID":"20240510142501-dafi091","Type":"NodeParagraph","Properties":{"id":"20240510142501-dafi091","updated":"20250220131234"},"Children":[{"Type":"NodeText","Data":"渲染管线（流水线）中的应用阶段，主要是 CPU 主导的阶段，\n它为渲染完成的最主要的工作就是提供后续的渲染数据，比如：\n顶点、法线、切线、纹理坐标、变换矩阵、材质属性等等，"}]},{"ID":"20250220131243-7e74oxs","Type":"NodeParagraph","Properties":{"id":"20250220131243-7e74oxs","updated":"20250220131246"},"Children":[{"Type":"NodeText","Data":"在应用阶段中，我们主要就是按照 Unity 的规则进行游戏开发即可，\nDrawCall 过多时，性能瓶颈是由 CPU 造成的，我们可以用批处理技术优化它"}]},{"ID":"20240510141812-f4s0iot","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240510141812-f4s0iot","updated":"20250220131257"},"Children":[{"Type":"NodeText","Data":"应用阶段为渲染准备了些什么？"}]},{"ID":"20240510141853-e85fexe","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240510141853-e85fexe","updated":"20250220131252"},"Children":[{"ID":"20240510141858-g0hn8l6","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240510141858-g0hn8l6","updated":"20240510141858"},"Children":[{"ID":"20240510141858-96s12c3","Type":"NodeParagraph","Properties":{"id":"20240510141858-96s12c3","updated":"20240510141858"},"Children":[{"Type":"NodeText","Data":"把不可见的物体数据剔除"}]}]},{"ID":"20240510141858-6vntbi3","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240510141858-6vntbi3","updated":"20240510141858"},"Children":[{"ID":"20240510141858-gv57pqs","Type":"NodeParagraph","Properties":{"id":"20240510141858-gv57pqs","updated":"20240510141858"},"Children":[{"Type":"NodeText","Data":"准备好模型相关数据（顶点、法线、切线、贴图、着色器等等）"}]}]},{"ID":"20240510141858-detqf6n","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240510141858-detqf6n","updated":"20240510141858"},"Children":[{"ID":"20240510141858-4kacbgs","Type":"NodeParagraph","Properties":{"id":"20240510141858-4kacbgs","updated":"20240510141858"},"Children":[{"Type":"NodeText","Data":"将数据加载到显存中"}]}]},{"ID":"20240510141858-pe5yke4","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20240510141858-pe5yke4","updated":"20240510141858"},"Children":[{"ID":"20240510141858-efb674l","Type":"NodeParagraph","Properties":{"id":"20240510141858-efb674l","updated":"20240510141858"},"Children":[{"Type":"NodeText","Data":"设置渲染状态（设置网格需要使用那个着色器、材质、光源属性等等）"}]}]},{"ID":"20240510141858-48rsrp2","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NS4=","Num":5},"Properties":{"id":"20240510141858-48rsrp2","updated":"20250220131252"},"Children":[{"ID":"20240510141858-dlctgcd","Type":"NodeParagraph","Properties":{"id":"20240510141858-dlctgcd","updated":"20250220131252"},"Children":[{"Type":"NodeText","Data":"调用 DrawCall（CPU 通知 GPU 使用相关的数据和渲染状态进行渲染）"}]}]}]},{"ID":"20240510142000-3x2jc1t","Type":"NodeParagraph","Properties":{"id":"20240510142000-3x2jc1t","updated":"20240510144722"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"width: 874px;","style":"width: 864px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240510142000-002taaw.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 864px;\" parent-style=\"width: 874px;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240510142145-hhqa7em","Type":"NodeParagraph","Properties":{"id":"20240510142145-hhqa7em","updated":"20240510144722"},"Children":[{"Type":"NodeText","Data":"渲染管线（流水线）中的应用阶段，主要是"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"CPU主导的阶段，"},{"Type":"NodeText","Data":"它为渲染完成的最主要的工作就是"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"提供后续的渲染数据"}]},{"ID":"20240510142216-xrzhut4","Type":"NodeParagraph","Properties":{"id":"20240510142216-xrzhut4","updated":"20250220131257"},"Children":[{"Type":"NodeText","Data":"比如：\n顶点、法线、切线、纹理坐标、变换矩阵、材质属性等等\n在应用阶段中，"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"我们主要就是按照 Unity 的规则进行游戏开发即可"},{"Type":"NodeText","Data":"\n我们需要注意的就是"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"关于 DrawCall 的优化"}]},{"ID":"20240510142221-b15v5xs","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240510142221-b15v5xs","updated":"20250220131328"},"Children":[{"Type":"NodeText","Data":"DrawCall"}]},{"ID":"20240510142251-y3v3obl","Type":"NodeParagraph","Properties":{"id":"20240510142251-y3v3obl","updated":"20250220131306"},"Children":[{"Type":"NodeText","Data":"我们之前在讲解UI相关知识点时，提到了 "},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20230720180557-uarfr3k","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"Drawcall"},{"Type":"NodeText","Data":"，也知道它会影响我们游戏的性能\n一次 DrawCall 其实就是 CPU 命令 GPU 进行渲染的命令，为什么 DrawCall 多了会影响性能呢？"}]},{"ID":"20240510142306-rk807b6","Type":"NodeParagraph","Properties":{"id":"20240510142306-rk807b6","updated":"20250220131323"},"Children":[{"Type":"NodeText","Data":"主要的性能的瓶颈是 CPU 造成的，每次调用 DrawCall 之前，CPU 需要向 GPU 发送很多内容，包括数据、状态、命令等等。\n"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如果 DrawCall 过多，CPU 就会把大量的时间花费在提交 DrawCall 上，造成 CPU 过载，让玩家感受到卡顿"}]},{"ID":"20240510142433-2zul9au","Type":"NodeParagraph","Properties":{"id":"20240510142433-2zul9au","updated":"20250220131325"},"Children":[{"Type":"NodeText","Data":"使用批处理，可以有效的减少 DrawCall，从而提升性能表现："}]},{"ID":"20240510142437-4mb0cd8","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240510142437-4mb0cd8","updated":"20250220131328"},"Children":[{"ID":"20240510142437-gb07y2a","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240510142437-gb07y2a","updated":"20240510142437"},"Children":[{"ID":"20240510142437-acg52hn","Type":"NodeParagraph","Properties":{"id":"20240510142437-acg52hn","updated":"20240510142437"},"Children":[{"Type":"NodeText","Data":"合并网格（可以将静态物体合并网格）"}]}]},{"ID":"20240510142437-wlmeves","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240510142437-wlmeves","updated":"20240510142437"},"Children":[{"ID":"20240510142437-gh2cobu","Type":"NodeParagraph","Properties":{"id":"20240510142437-gh2cobu","updated":"20240510142437"},"Children":[{"Type":"NodeText","Data":"共用材质（在不同网格之间共用一种材质）"}]}]},{"ID":"20240510142437-858t3rb","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240510142437-858t3rb","updated":"20250220131328"},"Children":[{"ID":"20240510142437-0k9oswt","Type":"NodeParagraph","Properties":{"id":"20240510142437-0k9oswt","updated":"20250220131328"},"Children":[{"Type":"NodeText","Data":"合并图集（2D 游戏和 UI 中，可以将多张图片合并为一张大图）"}]}]}]},{"ID":"20240510142436-uz01w0r","Type":"NodeParagraph","Properties":{"id":"20240510142436-uz01w0r","updated":"20240510144722"},"Children":[{"Type":"NodeText","Data":"等等"}]}]}