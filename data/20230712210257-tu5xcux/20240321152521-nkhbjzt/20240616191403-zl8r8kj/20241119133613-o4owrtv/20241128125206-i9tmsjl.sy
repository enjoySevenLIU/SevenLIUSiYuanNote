{"ID":"20241128125206-i9tmsjl","Spec":"1","Type":"NodeDocument","Properties":{"id":"20241128125206-i9tmsjl","title":"US3S5L5——聚光灯衰减计算","type":"doc","updated":"20241202114640"},"Children":[{"ID":"20241128125206-t9lpfue","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241128125206-t9lpfue","updated":"20241129121536"},"Children":[{"Type":"NodeText","Data":"聚光灯默认Cookie"}]},{"ID":"20241129121245-43duaq4","Type":"NodeParagraph","Properties":{"id":"20241129121245-43duaq4","updated":"20241129121558"},"Children":[{"Type":"NodeText","Data":"灯光组件中有一个 "},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240321164447-rxtjarn","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"Cookie"},{"Type":"NodeText","Data":" 参数，是用来关联光照遮罩图片的\n对于平行光和点光源，默认是不会提供任何光照遮罩信息的\n但是对于聚光灯来说，Unity 会默认为它提供一个 Cookie 光照遮罩，主要是用于模拟聚光灯的区域性"}]},{"ID":"20241129121305-reh5566","Type":"NodeParagraph","Properties":{"id":"20241129121305-reh5566","updated":"20241129121504"},"Children":[{"Type":"NodeText","Data":"而此时 光照纹理中"}]},{"ID":"20241129121504-logg447","Type":"NodeList","ListData":{},"Properties":{"id":"20241129121504-logg447","updated":"20241129121517"},"Children":[{"ID":"20241129121504-chpx3or","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241129121504-chpx3or","updated":"20241129121515"},"Children":[{"ID":"20241129121504-jp02629","Type":"NodeParagraph","Properties":{"id":"20241129121504-jp02629","updated":"20241129121515"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_LightTexture0"},{"Type":"NodeText","Data":"​：存储的是 Cookie 纹理信息"}]}]},{"ID":"20241129121505-ci6ams7","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241129121505-ci6ams7","updated":"20241129121517"},"Children":[{"ID":"20241129121505-llbnqjk","Type":"NodeParagraph","Properties":{"id":"20241129121505-llbnqjk","updated":"20241129121517"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_LightTextureB0"},{"Type":"NodeText","Data":"​：存储的是光照纹理信息，里面包含衰减值"}]}]}]},{"ID":"20241129121458-ondnv65","Type":"NodeParagraph","Properties":{"id":"20241129121458-ondnv65","updated":"20241129121536"},"Children":[{"Type":"NodeText","Data":"因此"}]},{"ID":"20241129121536-z032b3v","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20241129121536-z032b3v","updated":"20241129121536"},"Children":[{"ID":"20241129121536-dpm20ee","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20241129121536-dpm20ee","updated":"20241129121536"},"Children":[{"ID":"20241129121536-avhi1xh","Type":"NodeParagraph","Properties":{"id":"20241129121536-avhi1xh","updated":"20241129121540"},"Children":[{"Type":"NodeText","Data":"获取聚光灯衰减值时，需要从 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_LightTextureB0"},{"Type":"NodeText","Data":"​ 中进行采样"}]}]},{"ID":"20241129121536-fde841h","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20241129121536-fde841h","updated":"20241129121536"},"Children":[{"ID":"20241129121536-2bltgpq","Type":"NodeParagraph","Properties":{"id":"20241129121536-2bltgpq","updated":"20241129121542"},"Children":[{"Type":"NodeText","Data":"获取遮罩范围相关数据时，需要从 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_LightTexture0"},{"Type":"NodeText","Data":"​ 中进行采样"}]}]}]},{"ID":"20241129123839-ujcdnn8","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241129123839-ujcdnn8","updated":"20241202114640"},"Children":[{"Type":"NodeText","Data":"聚光灯衰减计算"}]},{"ID":"20241129123835-vc6w8g6","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20241129123835-vc6w8g6","updated":"20241202114640"},"Children":[{"ID":"20241129123856-x4t3v18","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20241129123856-x4t3v18","updated":"20241202114637"},"Children":[{"ID":"20241129123856-igu4y3i","Type":"NodeParagraph","Properties":{"id":"20241129123856-igu4y3i","updated":"20241129123856"},"Children":[{"Type":"NodeText","Data":"将顶点从世界空间转换到光源空间"}]},{"ID":"20241129123900-z66w1vo","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241129123900-z66w1vo","updated":"20241202114637"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"float4 lightCoord = mul(unity_WorldToLight, float4(i.worldPos, 1));\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241129123858-qjuihae","Type":"NodeParagraph","Properties":{"id":"20241129123858-qjuihae","updated":"20241129124615"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"注意：这里我们转换后和点光源不同的是，点光源只会获取其中的"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"xyz"},{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"，而聚光灯会获取其中的"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"xyzw"},{"Type":"NodeText","Data":"​\n这是因为在聚光灯光源空间下的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"w"},{"Type":"NodeText","Data":"​ 值有特殊含义，会参与后续的范围计算"}]}]},{"ID":"20241129123856-hc8uon9","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20241129123856-hc8uon9","updated":"20241202114640"},"Children":[{"ID":"20241129123856-q2s70zp","Type":"NodeParagraph","Properties":{"id":"20241129123856-q2s70zp","updated":"20241129124001"},"Children":[{"Type":"NodeText","Data":"利用光源空间下的坐标信息，通过3个步骤去获取聚光灯的衰减信息\n"}]},{"ID":"20241129124002-cmky5mk","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241129124002-cmky5mk","updated":"20241202114634"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"fixed atten = (lightCoord.z \u003e 0) * \t                                            //第一步，通过z分量判断目标点是否在聚光灯背面\n    tex2D(_LightTexture0, lightCoord.xy / lightCoord.w + 0.5).w *               //第二步，将坐标进行变换后从cookie纹理内取出遮罩衰减值\n    tex2D(_LightTextureB0, dot(lightCoord, lightCoord).rr).UNITY_ATTEN_CHANNEL; //第三步，根据坐标从光照衰减纹理内取出距离衰减值\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241129124618-wwd189a","Type":"NodeParagraph","Properties":{"id":"20241129124618-wwd189a","updated":"20241129124643"},"Children":[{"Type":"NodeText","Data":"这三个步骤得到的值最终会相乘，得到最终的衰减消息"}]},{"ID":"20241129123835-lkrfe3c","Type":"NodeList","ListData":{},"Properties":{"id":"20241129123835-lkrfe3c","updated":"20241202114640"},"Children":[{"ID":"20241129124121-80h5q1u","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241129124121-80h5q1u","updated":"20241202114640"},"Children":[{"ID":"20241129124121-ki3fc9n","Type":"NodeParagraph","Properties":{"id":"20241129124121-ki3fc9n","updated":"20241129132647"},"Children":[{"Type":"NodeText","Data":"首先分析和点光源相同的部分 —— 第三步：获取距离衰减值"}]},{"ID":"20241129124134-80poorj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241129124134-80poorj","updated":"20241202114640"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"tex2D(_LightTextureB0, dot(lightCoord, lightCoord).rr).UNITY_ATTEN_CHANNEL;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241129124826-40ssboj","Type":"NodeParagraph","Properties":{"id":"20241129124826-40ssboj","updated":"20241129124931"},"Children":[{"Type":"NodeText","Data":"这里的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"rr"},{"Type":"NodeText","Data":"​ 和 点光源使用的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"xx"},{"Type":"NodeText","Data":"​ 是等价的，目的都是构建一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"float2"},{"Type":"NodeText","Data":"​ 代表 uv 坐标，即 "},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"(distance^2, distance^2)"}]},{"ID":"20241129124136-m6auot0","Type":"NodeParagraph","Properties":{"id":"20241129124136-m6auot0","updated":"20241129124944"},"Children":[{"Type":"NodeText","Data":"这一步的规则和 "},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20241128121859-h6voymk","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"点光源"},{"Type":"NodeText","Data":" 规则一致，直接根据距离光源原点距离的平方从光照纹理中获取衰减值，需要注意的是："}]},{"ID":"20241129124143-4pp391m","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20241129124143-4pp391m","updated":"20241129125056"},"Children":[{"ID":"20241129124143-ow7tsbt","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20241129124143-ow7tsbt","updated":"20241129124143"},"Children":[{"ID":"20241129124143-0rkmgui","Type":"NodeParagraph","Properties":{"id":"20241129124143-0rkmgui","updated":"20241129124204"},"Children":[{"Type":"NodeText","Data":"聚光灯的光照衰减纹理为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_LightTextureB0"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20241129124143-uw0eckb","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20241129124143-uw0eckb","updated":"20241129125056"},"Children":[{"ID":"20241129124143-dwshrhd","Type":"NodeParagraph","Properties":{"id":"20241129124143-dwshrhd","updated":"20241129125056"},"Children":[{"Type":"NodeText","Data":"点乘 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"dot"},{"Type":"NodeText","Data":"​ 函数只会计算 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"xyz"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"w"},{"Type":"NodeText","Data":"​ 不会计算"}]}]}]}]},{"ID":"20241129124217-vg4kqdu","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241129124217-vg4kqdu","updated":"20241202110000"},"Children":[{"ID":"20241129124217-zjr93nk","Type":"NodeParagraph","Properties":{"id":"20241129124217-zjr93nk","updated":"20241129124228"},"Children":[{"Type":"NodeText","Data":"接下来分析用于进行范围判断的部分 —— 第一、二步"}]},{"ID":"20241129124234-rhv9lph","Type":"NodeList","ListData":{},"Properties":{"id":"20241129124234-rhv9lph","updated":"20241202110000"},"Children":[{"ID":"20241129124230-3ymie7a","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241129124230-3ymie7a","updated":"20241129132710"},"Children":[{"ID":"20241129124230-mjeni48","Type":"NodeParagraph","Properties":{"id":"20241129124230-mjeni48","updated":"20241129132710"},"Children":[{"Type":"NodeText","Data":"第一步 - 判断是否在背面："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"(lightCoord.z \u0026gt; 0)"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241129124313-259bej4","Type":"NodeParagraph","Properties":{"id":"20241129124313-259bej4","updated":"20241129125116"},"Children":[{"Type":"NodeText","Data":"CG 语法中没有显示的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"bool"},{"Type":"NodeText","Data":"​ 类型，一般情况下 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"0"},{"Type":"NodeText","Data":"​ 表示 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"false"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"1"},{"Type":"NodeText","Data":"​ 表示 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"true"},{"Type":"NodeText","Data":"​，\n也就是说 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lightCoord.z \u0026gt; 0"},{"Type":"NodeText","Data":"​ 的返回值，条件满足时为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"1"},{"Type":"NodeText","Data":"​，条件不满足为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"0"},{"Type":"NodeText","Data":"​\n"}]},{"ID":"20241129125124-u9a1qjb","Type":"NodeParagraph","Properties":{"id":"20241129125124-u9a1qjb","updated":"20241129125828"},"Children":[{"Type":"NodeText","Data":"这里的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"z"},{"Type":"NodeText","Data":"​ 分量代表的其实是 目标点 相对于 聚光灯照射面 距离\n如果 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lightCoord.z \u0026lt;= 0"},{"Type":"NodeText","Data":"​ 证明在聚光灯照射方向的背面，就不应该受到聚光灯的影响\n若 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lightCoord.z \u0026lt;= 0"},{"Type":"NodeText","Data":"​，就得到 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"0"},{"Type":"NodeText","Data":"​，于是，后面的值即使相乘也是 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"0"},{"Type":"NodeText","Data":"​，相当于不受聚光灯光照影响"}]},{"ID":"20241129125340-p747yl2","Type":"NodeParagraph","Properties":{"id":"20241129125340-p747yl2","updated":"20241129125841"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241129125340-3uvvpkb.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"光源坐标系下的z轴值代表顶点到光源面的距离"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241129125831-1fuv4os","Type":"NodeParagraph","Properties":{"id":"20241129125831-1fuv4os","updated":"20241129125831"},"Children":[{"Type":"NodeText","Data":"也就是说这一步的主要作用，是用来决定顶点是否受到聚光灯光照的影响"}]}]},{"ID":"20241129124346-i0fahjg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241129124346-i0fahjg","updated":"20241202110000"},"Children":[{"ID":"20241129124346-l5c9hj5","Type":"NodeParagraph","Properties":{"id":"20241129124346-l5c9hj5","updated":"20241129132752"},"Children":[{"Type":"NodeText","Data":"第二步 - 取出 cookie 纹理衰减值："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"tex2D(_LightTexture0, lightCoord.xy / lightCoord.w + 0.5).w"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241129124403-73lx315","Type":"NodeParagraph","Properties":{"id":"20241129124403-73lx315","updated":"20241129125945"},"Children":[{"Type":"NodeText","Data":"我们以前在进行 "},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240710211945-ki6ph40","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"纹理采样"},{"Type":"NodeText","Data":" 时都会进行一个 先缩放 后 平移 的操作，\n比如："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"uv = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;"},{"Type":"NodeText","Data":"​\n而第二步中的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lightCoord.xy / lightCoord.w + 0.5"},{"Type":"NodeText","Data":"​ 其实也是在做这样的一个操作"}]},{"ID":"20241129125906-jzjm2op","Type":"NodeParagraph","Properties":{"id":"20241129125906-jzjm2op","updated":"20241202104653"},"Children":[{"Type":"NodeText","Data":"这样做的主要目的是因为：我们需要把 uv 坐标映射到 0"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"~"}]},{"Type":"NodeText","Data":"1 的范围内再从 cookie 纹理中采样，\n因为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lightCoord.xy / lightCoord.w"},{"Type":"NodeText","Data":"​ 进行缩放后，x, y 的取值范围是 -0.5"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"~"}]},{"Type":"NodeText","Data":"0.5 之间\n因此再加上 0.5 后，x, y 的取值范围就是 0"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"~"}]},{"Type":"NodeText","Data":"1 之间，便可以进行正确的纹理采样了"}]},{"ID":"20241129132806-s5thnuv","Type":"NodeParagraph","Properties":{"id":"20241129132806-s5thnuv","updated":"20241202110000"},"Children":[{"Type":"NodeText","Data":"而 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lightCoord.xy / lightCoord.w"},{"Type":"NodeText","Data":"​ 是因为聚光灯有很多横截面，我们需要把各横截面通过缩放的形式映射到最大的面上进行采样\n​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lightCoord.xy / lightCoord.w"},{"Type":"NodeText","Data":"​ 就可以得到 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lightCoord"},{"Type":"NodeText","Data":"​ 坐标对应的最大横截面上的坐标，这里具体的数学推导不展开"}]},{"ID":"20241129132125-t3p4wl8","Type":"NodeParagraph","Properties":{"id":"20241129132125-t3p4wl8","updated":"20241129132125"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"style":"width: 270px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241129132125-smrv661.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 270px;\"}"},{"Type":"NodeText","Data":"​"}]}]}]}]}]}]}]},{"ID":"20241129124600-ddbfs6x","Type":"NodeParagraph","Properties":{"id":"20241129124600-ddbfs6x","updated":"20241202110202"},"Children":[{"Type":"NodeText","Data":"因此我们总结一下，看似复杂的聚光灯光照衰减计算方式，其实就是由"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"“cookie遮罩值”"},{"Type":"NodeText","Data":"和"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"距离衰减"},{"Type":"NodeText","Data":"共同决定的"}]},{"ID":"20241129133032-2fkt6ij","Type":"NodeList","ListData":{},"Properties":{"id":"20241129133032-2fkt6ij","updated":"20241202103724"},"Children":[{"ID":"20241129133032-79l37wk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241129133032-79l37wk","updated":"20241129133058"},"Children":[{"ID":"20241129133032-4kb45rt","Type":"NodeParagraph","Properties":{"id":"20241129133032-4kb45rt","updated":"20241129133058"},"Children":[{"Type":"NodeText","Data":"第一步：判断是否能有机会照到光，看得到为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"1"},{"Type":"NodeText","Data":"​，看不到为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"0"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"(lightCoord.z \u0026gt; 0)"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20241129133033-3cqcfi6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241129133033-3cqcfi6","updated":"20241202103724"},"Children":[{"ID":"20241129133033-nr194hw","Type":"NodeParagraph","Properties":{"id":"20241129133033-nr194hw","updated":"20241202103724"},"Children":[{"Type":"NodeText","Data":"第二步：缩放平移，映射到遮罩纹理采样 根据遮罩纹理的信息决定衰减叠加："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"tex2D(_LightTexture0, lightCoord.xy / lightCoord.w + 0.5).w"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20241129133035-tgupwh0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241129133035-tgupwh0","updated":"20241129133120"},"Children":[{"ID":"20241129133035-mgvy02h","Type":"NodeParagraph","Properties":{"id":"20241129133035-mgvy02h","updated":"20241129133120"},"Children":[{"Type":"NodeText","Data":"第三步：从光照衰减纹理中取出按距离得到的衰减值："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"tex2D(_LightTextureB0, dot(lightCoord, lightCoord).rr).UNITY_ATTEN_CHANNEL"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20241129133231-n206prx","Type":"NodeParagraph","Properties":{"id":"20241129133231-n206prx","updated":"20241129133237"},"Children":[{"Type":"NodeText","Data":"这三个步骤得到的值最终会相乘，得到最终的光照衰减值"}]},{"ID":"20241202105426-f7f8hp8","Type":"NodeParagraph","Properties":{"id":"20241202105426-f7f8hp8","updated":"20241202105426"}}]}