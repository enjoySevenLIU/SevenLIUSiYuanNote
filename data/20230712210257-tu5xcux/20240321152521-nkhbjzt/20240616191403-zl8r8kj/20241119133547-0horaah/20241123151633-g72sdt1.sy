{"ID":"20241123151633-g72sdt1","Spec":"1","Type":"NodeDocument","Properties":{"id":"20241123151633-g72sdt1","title":"US3S4L1——渲染管线概述","type":"doc","updated":"20250314113541"},"Children":[{"ID":"20241123151651-vpvao9t","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20241123151651-vpvao9t","updated":"20241123151759"},"Children":[{"Type":"NodeText","Data":"渲染路径"}]},{"ID":"20241123151706-tlz5z24","Type":"NodeParagraph","Properties":{"id":"20241123151706-tlz5z24","updated":"20241123151706"},"Children":[{"Type":"NodeText","Data":"渲染路径（Rendering Path）是指在图形渲染过程中，图形引擎按照特定的步骤和顺序来处理场景中的几何、光照、材质等信息，最终生成屏幕上的图像的一种算法或策略。它决定了图形引擎如何组织和执行渲染过程，以产生最终的视觉效果。"}]},{"ID":"20241123151706-2oo9l8a","Type":"NodeParagraph","Properties":{"id":"20241123151706-2oo9l8a","updated":"20241123151706"},"Children":[{"Type":"NodeText","Data":"对于我们来说：在 Unity 中，"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"渲染路径决定了光照如何应用到 Unity Shader 中"},{"Type":"NodeText","Data":"，如果要在 Unity Shader 中和光源打交道，我们需要为每个 Pass 渲染通道匹配对应的渲染路径，这样"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"才能在 Shader 当中获取到正确的光源数据进行处理"},{"Type":"NodeText","Data":"。"}]},{"ID":"20241123151706-iqx9w7v","Type":"NodeParagraph","Properties":{"id":"20241123151706-iqx9w7v","updated":"20241123151706"},"Children":[{"Type":"NodeText","Data":"总而言之："},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"渲染路径会影响光照处理，从而影响最终的渲染效果（光照、阴影等），Unity"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"存在多种不同的渲染路径"}]},{"ID":"20241123151706-rvib8m9","Type":"NodeParagraph","Properties":{"id":"20241123151706-rvib8m9","updated":"20241123151706"},"Children":[{"Type":"NodeText","Data":"影响原因：简单来说，使用不同的渲染路径时，Unity 在 Shader 中准备光源数据的流程是不同的，那么在 Shader 开发时，获取光源数据的方式就会有所不同"}]},{"ID":"20241123151649-20wbg2d","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241123151649-20wbg2d","updated":"20241123151649"},"Children":[{"Type":"NodeText","Data":"渲染路径的种类和设置"}]},{"ID":"20241123151649-em4lm2g","Type":"NodeParagraph","Properties":{"id":"20241123151649-em4lm2g","updated":"20241123151649"},"Children":[{"Type":"NodeText","Data":"我们可以在 "},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20230709193827-nst3dof","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"Camera"},{"Type":"NodeText","Data":" 组件中的 "},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20230709202338-qq2grfq","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"Rendering Path"},{"Type":"NodeText","Data":"（渲染路径）对其进行修改，在"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"内置渲染管线"},{"Type":"NodeText","Data":"中主要有3种渲染路径，分别是："}]},{"ID":"20241123151649-bx7nmve","Type":"NodeList","ListData":{},"Properties":{"id":"20241123151649-bx7nmve","updated":"20241123151649"},"Children":[{"ID":"20241123151649-b6uirom","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241123151649-b6uirom","updated":"20241123151649"},"Children":[{"ID":"20241123151649-pvdbhs7","Type":"NodeParagraph","Properties":{"id":"20241123151649-pvdbhs7","updated":"20241123151649"},"Children":[{"Type":"NodeText","Data":"Forward（前向渲染路径）：默认的标准的渲染方式，适用于相对简单的场景和较少的光源"}]}]},{"ID":"20241123151649-ouc4icy","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241123151649-ouc4icy","updated":"20241123151649"},"Children":[{"ID":"20241123151649-tpg084f","Type":"NodeParagraph","Properties":{"id":"20241123151649-tpg084f","updated":"20241123151649"},"Children":[{"Type":"NodeText","Data":"Deferred（延迟渲染路径）：可以处理较复杂的场景，有大量光源时可以提供更好的性能"}]}]},{"ID":"20241123151649-dzu1x56","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241123151649-dzu1x56","updated":"20241123151649"},"Children":[{"ID":"20241123151649-pfmoxk1","Type":"NodeParagraph","Properties":{"id":"20241123151649-pfmoxk1","updated":"20241123151649"},"Children":[{"Type":"NodeText","Data":"Legacy Vertex Lit（（遗产）顶点照明渲染路径）：较适用于为简单的渲染方式，适用于性能受限的场景。基本已经不会使用"}]}]}]},{"ID":"20241123151649-ykmkzp0","Type":"NodeParagraph","Properties":{"id":"20241123151649-ykmkzp0","updated":"20241123151649"},"Children":[{"Type":"NodeText","Data":"这里是 Unity 的 Built-in 内置渲染管线的渲染路径选项，而非 URP、HDRP、SRP 等管线的选项"}]},{"ID":"20241123151649-1gxxscj","Type":"NodeBlockquote","Properties":{"id":"20241123151649-1gxxscj","style":"background-color: var(--b3-card-warning-background); color: var(--b3-card-warning-color);","updated":"20241123151649"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20241123151649-sclvc96","Type":"NodeParagraph","Properties":{"id":"20241123151649-sclvc96","updated":"20241123151649"},"Children":[{"Type":"NodeText","Data":"注意：当显卡不支持选定的渲染路径时会自动选择一个较低精度的渲染路径，比如不支持延迟渲染路径时，前向渲染路径会被采用"}]}]},{"ID":"20241123151649-j4hmhiy","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241123151649-j4hmhiy","updated":"20250314113541"},"Children":[{"Type":"NodeText","Data":"LightMode 标签的作用"}]},{"ID":"20241123151649-g8fcprn","Type":"NodeParagraph","Properties":{"id":"20241123151649-g8fcprn","updated":"20241123152359"},"Children":[{"Type":"NodeText","Data":"我们之前在编写 Shader 时都会使用 "},{"Type":"NodeTextMark","TextMarkType":"code block-ref","TextMarkBlockRefID":"20240615191133-56z8a1m","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"LightMode"},{"Type":"NodeText","Data":"​（光模式）标签。"}]},{"ID":"20241123152411-1vvmjgq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241123152411-1vvmjgq","style":"line-height: 22px;","updated":"20241123152411"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YyM="},{"Type":"NodeCodeBlockCode","Data":"Tags{ \"LightMode\" = \"标签值\" }\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241123152407-6eddllx","Type":"NodeParagraph","Properties":{"id":"20241123152407-6eddllx","updated":"20241123152407"},"Children":[{"Type":"NodeText","Data":"它的主要作用就是来指明该 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​ 匹配的渲染路径是哪种，只要匹配正确，我们便可以获取到正确的光源相关数据"}]},{"ID":"20241123151649-nb3ja12","Type":"NodeParagraph","Properties":{"id":"20241123151649-nb3ja12","updated":"20241123151649"},"Children":[{"Type":"NodeText","Data":"注意："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"LightMode"},{"Type":"NodeText","Data":"​ 标签通常应该与 Camera 中的 Rendering Path 匹配\n用于指定 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​ 在渲染过程中的哪个阶段，"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如果它们不匹配，可能导致渲染不正确"}]},{"ID":"20241123151649-vuiyub5","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"min-width: 60px;|min-width: 60px;","id":"20241123151649-vuiyub5","updated":"20250314113541"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"标签名"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"描述"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Always"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"不管使用哪种渲染路径，该 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​ 始终渲染，但不会计算任何光照"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"ForwardBase"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"前向渲染路径的基础照明阶段执行的Pass，该"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​ "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"会计算环境光、重要的平行光、逐顶点/SH（球谐函数光照相关）光源和"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"Lightmaps"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"ForwardAdd"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"前向渲染路径的额外照明阶段执行的"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"，该"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​ "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"会计算额外的逐像 素光源，每个"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​ "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"对应一个光源"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"Deferred"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"延迟渲染路径中执行的"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"，用于几何阶段之后执行光照计算，该"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​ "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"会渲染 G 缓冲（G-buffer，详见："},{"Type":"NodeTextMark","TextMarkType":"strong block-ref","TextMarkBlockRefID":"20241123165740-670iqoh","TextMarkBlockRefSubtype":"d","TextMarkTextContent":"US3S4L4——延迟渲染路径"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"）"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"ShadowCaster"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"用于生成阴影图的"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"，通常用于阴影投射。把物体的深度信息渲染到阴影映射纹理或一张深度纹理中"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"MotionVectors"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于生成运动矢量的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​，通常用于运动模糊"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Meta"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于在渲染对象元数据时执行的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Vertex"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"VertexLMRGBM"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"VertexLM"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于遗留的顶点照明渲染（基本不使用了）"}]}]}]},{"ID":"20241123151649-yd5a9k4","Type":"NodeParagraph","Properties":{"id":"20241123151649-yd5a9k4","updated":"20241123151649"},"Children":[{"Type":"NodeText","Data":"在 Shader 开发中如果我们不进行 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"LightMode"},{"Type":"NodeText","Data":"​ 渲染标签的设置。\n比如摄像机默认的是前向渲染路径，但是我们没有为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​ 设置相关的标签，那么这个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​ 会被当作一个顶点照明渲染路径的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​。\n这时光源相关的数据就不会被正确的进行赋值，我们计算出来的结果就会出现错误，"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"从而可能呈现出错误的渲染效果"},{"Type":"NodeText","Data":"。\n"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"因此，在进行 Unity Shader 开发时，我们需要对"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"Pass"},{"Type":"NodeText","Data":"​ "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"渲染通道进行正确的"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"LightMode"},{"Type":"NodeText","Data":"​ "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"标签设置，从而匹配当前使用的渲染路径"}]}]}