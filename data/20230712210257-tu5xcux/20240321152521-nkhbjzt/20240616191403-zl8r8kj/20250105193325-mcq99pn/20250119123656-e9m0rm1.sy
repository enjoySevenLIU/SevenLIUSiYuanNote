{"ID":"20250119123656-e9m0rm1","Spec":"1","Type":"NodeDocument","Properties":{"id":"20250119123656-e9m0rm1","title":"US3S11L1——屏幕深度和法线纹理的使用","type":"doc","updated":"20250121130234"},"Children":[{"ID":"20250119123656-2ua8wsc","Type":"NodeHeading","HeadingLevel":2,"Properties":{"alias":"DepthTextureMode.Depth,DepthTextureMode.DepthNormals,_CameraDepthNormalsTexture","id":"20250119123656-2ua8wsc","name":"camera.depthTextureMode","updated":"20250119124412"},"Children":[{"Type":"NodeText","Data":"深度和法线纹理的使用"}]},{"ID":"20250119123726-vjea54v","Type":"NodeParagraph","Properties":{"id":"20250119123726-vjea54v","updated":"20250119123751"},"Children":[{"Type":"NodeText","Data":"使用屏幕深度和法线纹理，一般分两步："}]},{"ID":"20250119123757-0ctzwvv","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20250119123757-0ctzwvv","updated":"20250119124350"},"Children":[{"ID":"20250119123757-pbjmf3a","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20250119123757-pbjmf3a","updated":"20250119123757"},"Children":[{"ID":"20250119123757-9stvfk7","Type":"NodeParagraph","Properties":{"id":"20250119123757-9stvfk7","updated":"20250119123810"},"Children":[{"Type":"NodeText","Data":"让 Unity 知道我们需要使用深度和法线纹理"}]},{"ID":"20250119123813-8oo3afv","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250119123813-8oo3afv","style":"line-height: 22px;","updated":"20250119124045"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YyM="},{"Type":"NodeCodeBlockCode","Data":"private void Start()\n{\n    Camera.main.depthTextureMode = DepthTextureMode.Depth;\t\t\t\t\t\t\t\t\t// 获取一张深度纹理\n    Camera.main.depthTextureMode = DepthTextureMode.DepthNormals;\t\t\t\t\t\t\t// 获取一张深度+法线纹理\n    Camera.main.depthTextureMode = DepthTextureMode.Depth | DepthTextureMode.DepthNormals;\t// 获取深度纹理 和 深度+法线纹理\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20250119123806-rj7wzsj","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20250119123806-rj7wzsj","updated":"20250119124350"},"Children":[{"ID":"20250119123806-h200bxx","Type":"NodeParagraph","Properties":{"id":"20250119123806-h200bxx","updated":"20250119123808"},"Children":[{"Type":"NodeText","Data":"在 Shader 当中直接声明对应变量"}]},{"ID":"20250119124049-3cu80s6","Type":"NodeList","ListData":{},"Properties":{"id":"20250119124049-3cu80s6","updated":"20250119124128"},"Children":[{"ID":"20250119124128-pc9fqw7","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250119124128-pc9fqw7","updated":"20250119124128"},"Children":[{"ID":"20250119124128-9o27z5s","Type":"NodeParagraph","Properties":{"id":"20250119124128-9o27z5s","updated":"20250119124132"},"Children":[{"Type":"NodeText","Data":"深度纹理"}]},{"ID":"20250119124148-xsv438q","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250119124148-xsv438q","style":"line-height: 22px;","updated":"20250119124206"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"sampler2D _CameraDepthTexture;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20250119124208-gwui573","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250119124208-gwui573","updated":"20250119124208"},"Children":[{"ID":"20250119124208-3qfts8k","Type":"NodeParagraph","Properties":{"id":"20250119124208-3qfts8k","updated":"20250119124218"},"Children":[{"Type":"NodeText","Data":"深度+法线纹理："}]},{"ID":"20250119124244-2gkod0j","Type":"NodeParagraph","Properties":{"id":"20250119124244-2gkod0j","updated":"20250119124330"},"Children":[{"Type":"NodeText","Data":"其中，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_CameraDepthNormalsTexture.rg"},{"Type":"NodeText","Data":"​ 一般存储屏幕法线消息，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_CameraDepthNormalsTexture.ba"},{"Type":"NodeText","Data":"​ 一般存储屏幕深度消息"}]},{"ID":"20250119124218-rnbd5ch","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250119124218-rnbd5ch","style":"line-height: 22px;","updated":"20250119124336"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"sampler2D _CameraDepthNormalsTexture;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20250119124337-s34o6ph","Type":"NodeParagraph","Properties":{"id":"20250119124337-s34o6ph","updated":"20250119124350"},"Children":[{"Type":"NodeText","Data":"之后直接在 Shader 中使用这两个变量便可以获取到相关信息"}]}]}]},{"ID":"20250119124047-ywhyjqj","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250119124047-ywhyjqj","updated":"20250121130234"},"Children":[{"Type":"NodeText","Data":"使用深度和法线纹理需要的内置函数"}]},{"ID":"20250120125520-5c3qepr","Type":"NodeParagraph","Properties":{"id":"20250120125520-5c3qepr","updated":"20250120125540"},"Children":[{"Type":"NodeText","Data":"对于以下内置函数的原理，详见："},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20250119212626-hbriuzm","TextMarkBlockRefSubtype":"d","TextMarkTextContent":"US3S11L2——深度和法线纹理背后的原理"}]},{"ID":"20250119124431-3h9zy1e","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20250119124431-3h9zy1e","updated":"20250121130234"},"Children":[{"ID":"20250119124433-ad1ihvh","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"alias":"LinearEyeDepth(),Linear01Depth()","id":"20250119124433-ad1ihvh","name":"SAMPLE_DEPTH_TEXTURE()","updated":"20250121130234"},"Children":[{"ID":"20250119124433-86qvxpk","Type":"NodeParagraph","Properties":{"id":"20250119124433-86qvxpk","updated":"20250119134926"},"Children":[{"Type":"NodeText","Data":"获取深度纹理的深度值"}]},{"ID":"20250119135120-o2djv9x","Type":"NodeParagraph","Properties":{"id":"20250119135120-o2djv9x","updated":"20250121130234"},"Children":[{"Type":"NodeText","Data":"首先需要使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SAMPLE_DEPTH_TEXTURE()"},{"Type":"NodeText","Data":"​ 宏对 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_CameraDepthTexture"},{"Type":"NodeText","Data":"​ 采样，此时得到的采样结果是非线性的，\n然后，使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"LinearEyeDepth()"},{"Type":"NodeText","Data":"​ 将非线性的深度值转换到观察空间下，\n或者，使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Linear01Depth()"},{"Type":"NodeText","Data":"​ 将采样结果转换为 [0,1] 区间内的线性深度值（此方法不需要和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"LinearEyeDepth()"},{"Type":"NodeText","Data":"​ 配合使用！）"}]},{"ID":"20250119134926-jqqc5yr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250119134926-jqqc5yr","style":"line-height: 22px;","updated":"20250121130027"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"fixed4 frag(v2f i) : SV_Target\n{\n    float depth = SAMPLE_DEPTH_TEXTURE(_CameraDepthTexture, i.uv);  // 使用基本深度纹理采样，得到的结果是非线性的\n    float viewDepth = LinearEyeDepth(depth);                        // 将非线性的深度值转换到观察空间下\n    float linearDepth = Linear01Depth(depth);                   \t// 将非线性的深度值转换为[0,1]区间内的线性深度值\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20250119124437-oh4uq5q","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"alias":"DecodeFloatRG(),DecodeViewNormalStereo()","id":"20250119124437-oh4uq5q","name":"DecodeDepthNormal()","updated":"20250119143243"},"Children":[{"ID":"20250119124437-8heesgf","Type":"NodeParagraph","Properties":{"id":"20250119124437-8heesgf","updated":"20250119124457"},"Children":[{"Type":"NodeText","Data":"获取深度+法线纹理的法线消息"}]},{"ID":"20250119140904-vi8h6ek","Type":"NodeParagraph","Properties":{"id":"20250119140904-vi8h6ek","updated":"20250119143243"},"Children":[{"Type":"NodeText","Data":"其中，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"DecodeViewNormalStereo()"},{"Type":"NodeText","Data":"​ 是 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"UnityCG.cginc"},{"Type":"NodeText","Data":"​ 内置文件中的方法，用于同时得到深度值和法线消息\n而 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"DecodeFloatRG()"},{"Type":"NodeText","Data":"​ 可以单独得到深度值，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"DecodeViewNormalStereo()"},{"Type":"NodeText","Data":"​ 可以单独得到法线消息"}]},{"ID":"20250119124839-28xv461","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250119124839-28xv461","style":"line-height: 22px;","updated":"20250119140902"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"fixed4 frag(v2f i) : SV_Target\n{\n    float depth;                                                    // 用于存储深度值的变量\n    float3 normals;                                                 // 用于存储法线的变量\n    float4 depthNormal = tex2D(_CameraDepthNormalsTexture, i.uv);   // 对深度+法线纹理进行采样（xy是法线消息，zw是深度消息）\n    DecodeDepthNormal(depthNormal, depth, normals);                 // 一次处理得到深度值和法线消息\n    depth = DecodeFloatRG(depthNormal.zw);                          // 单独得到深度值\n    normals = DecodeViewNormalStereo(depthNormal);                  // 单独得到法线消息\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20250119124415-oiwl7v0","Type":"NodeParagraph","Properties":{"id":"20250119124415-oiwl7v0","updated":"20250119124415"}}]}