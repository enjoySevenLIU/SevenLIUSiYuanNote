{"ID":"20240324191730-bfydt31","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240324191730-bfydt31","title":"UH3L13——客户端热更新路径优化","type":"doc","updated":"20240324193308"},"Children":[{"ID":"20240324192041-acxkg2j","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240324192041-acxkg2j","updated":"20240615164942"},"Children":[{"Type":"NodeText","Data":"当前需要优化的问题"}]},{"ID":"20240324192049-gmiv5m3","Type":"NodeParagraph","Properties":{"id":"20240324192049-gmiv5m3","updated":"20240324192115"},"Children":[{"Type":"NodeText","Data":"不同平台的特殊路径，读取表现是不同的："}]},{"ID":"20240324192116-jphrxw0","Type":"NodeTable","TableAligns":[2,2,2,2,2],"Properties":{"colgroup":"min-width: 60px;|min-width: 60px;|width: 141px;|width: 253px;|width: 138px;","id":"20240324192116-jphrxw0","updated":"20240324195124"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","TableCellAlign":2},{"Type":"NodeTableCell","Data":"th","TableCellAlign":2,"Properties":{"colspan":"2","rowspan":"1"},"Children":[{"Type":"NodeKramdownSpanIAL","Data":"{: colspan=\"2\" rowspan=\"1\"}"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Application.persistentDataPath"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"th","TableCellAlign":2,"Properties":{"class":"fn__none"},"Children":[{"Type":"NodeKramdownSpanIAL","Data":"{: class=\"fn__none\"}"}]},{"Type":"NodeTableCell","Data":"th","TableCellAlign":2,"Properties":{"colspan":"2","rowspan":"1"},"Children":[{"Type":"NodeKramdownSpanIAL","Data":"{: colspan=\"2\" rowspan=\"1\"}"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Application.streamingAssetsPath"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"th","TableCellAlign":2,"Properties":{"class":"fn__none"},"Children":[{"Type":"NodeKramdownSpanIAL","Data":"{: class=\"fn__none\"}"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellAlign":2},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"UnityWebRequest"},{"Type":"NodeText","Data":"​或者"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WWW"},{"Type":"NodeText","Data":"​读取"},{"Type":"NodeBr","Data":"br"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"C"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"#"}]},{"Type":"NodeText","Data":"文件流读取"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"UnityWebRequest"},{"Type":"NodeText","Data":"​或者"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WWW"},{"Type":"NodeText","Data":"​读取"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"C"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"#"}]},{"Type":"NodeText","Data":"文件流读取"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"PC"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"加 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"file:///"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"无需处理"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"加 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"file:///"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"无需处理"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"Android"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"加 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"file:///"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"无需处理"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"直接用"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);"},"TextMarkType":"text","TextMarkTextContent":"不可用"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);\"}"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"IOS"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"加 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"file:///"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"无需处理"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"加 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"file:///"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"Children":[{"Type":"NodeText","Data":"无需处理"}]}]}]},{"ID":"20240324192538-fkbur29","Type":"NodeParagraph","Properties":{"id":"20240324192538-fkbur29","updated":"20240324200111"},"Children":[{"Type":"NodeText","Data":"如果我们不对不同平台加以判断，修改读取逻辑，可能就在不同平台上读取出现问题，因此我们需要优化热更新路径的逻辑"}]},{"ID":"20240324192737-r7zrven","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240324192737-r7zrven","updated":"20240615164942"},"Children":[{"Type":"NodeText","Data":"多路测试"}]},{"ID":"20240324192801-lomwaoy","Type":"NodeParagraph","Properties":{"id":"20240324192801-lomwaoy","updated":"20240324193931"},"Children":[{"Type":"NodeText","Data":"通过预处理器指令"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#if ... #elif ... #else .... #endif"},{"Type":"NodeText","Data":"​，可以选择性的编译C"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"#"}]},{"Type":"NodeText","Data":"部分代码\n如果"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#if"},{"Type":"NodeText","Data":"​和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#elif"},{"Type":"NodeText","Data":"​后边跟随的宏（或者说符号）被定义"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#define"},{"Type":"NodeText","Data":"​过，其与"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#endif"},{"Type":"NodeText","Data":"​包裹起来的代码就会被编译\n如果"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#if"},{"Type":"NodeText","Data":"​和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#elif"},{"Type":"NodeText","Data":"​后边跟随的宏（或者说符号）都没有被定义过"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#define"},{"Type":"NodeText","Data":"​过，则"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#else"},{"Type":"NodeText","Data":"​与"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#endif"},{"Type":"NodeText","Data":"​包裹起来的代码就会被编译"}]},{"ID":"20240324193430-14xywkn","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240324193430-14xywkn","style":"line-height: 22px;","updated":"20240324194347"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YyM="},{"Type":"NodeCodeBlockCode","Data":"//#define必须放在文件最开头，所有关键词前面\n#define Test    \n\nvoid Start()\n{\n#if UNITY_ANDROID\n\tprint(\"安卓平台才会编译执行的代码\");\n#elif UNITY_IOS\n\tprint(\"IOS平台才会编译执行的代码\");\n#else\n\tprint(\"其他平台会编译执行的代码\");\n#endif\n\n#if Test\n\tprint(\"定义了Test符号，因此会执行\")\n#endif\n\n#if Test2\n\tprint(\"未定义了Test1符号，因此不会执行\")\n#endif\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240324192742-uch11kh","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240324192742-uch11kh","updated":"20240324193308"},"Children":[{"Type":"NodeText","Data":"平台测试符号"}]},{"ID":"20240324193244-aqxn6rn","Type":"NodeParagraph","Properties":{"id":"20240324193244-aqxn6rn","updated":"20240324200747"},"Children":[{"Type":"NodeText","Data":"Unity 支持对脚本使用的平台 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#define"},{"Type":"NodeText","Data":"​ 指令如下："}]},{"ID":"20240324193045-z0ydq7l","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"|width: 831px;","id":"20240324193045-z0ydq7l","updated":"20240324192758"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Define"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"功能"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_EDITOR"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于从游戏代码中调用 Unity Editor 脚本的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_EDITOR_WIN"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于 Windows 上的 Editor 代码的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_EDITOR_OSX"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于 Mac OS X 上的 Editor 代码的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_EDITOR_LINUX"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于 Linux 上的 Editor 代码的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_STANDALONE_OSX"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于专门为 Mac OS X（包括 Universal、PPC 和 Intel 架构）编译或执行代码的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_STANDALONE_WIN"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于专门为 Windows 独立平台应用程序编译/执行代码的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_STANDALONE_LINUX"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于专门为 Linux 独立平台应用程序编译/执行代码的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_STANDALONE"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于为任何独立平台（Mac OS X、Windows 或 Linux）编译/执行代码的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_WII"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于为 Wii 游戏主机编译/执行代码的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_IOS"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于为 iOS 平台编译/执行代码的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_IPHONE"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"已弃用。改用 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_IOS"},{"Type":"NodeText","Data":"。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_ANDROID"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于 Android 平台的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_PS4"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于运行 PlayStation 4 代码的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_XBOXONE"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于执行 Xbox One 代码的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_LUMIN"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于 Magic Leap OS 平台的 #define 指令。也可以使用 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"PLATFORM_LUMIN"},{"Type":"NodeText","Data":"。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_TIZEN"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于 Tizen 平台的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_TVOS"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于 Apple TV 平台的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_WSA"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于通用 Windows 平台的 "},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"#"}]},{"Type":"NodeText","Data":"define 指令。此外，根据 .NET Core 和使用 .NET 脚本后端来编译 C# 文件时会定义 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"NETFX_CORE"},{"Type":"NodeText","Data":"。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_WSA_10_0"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于通用 Windows 平台的 "},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"#"}]},{"Type":"NodeText","Data":"define 指令。此外，根据 .NET Core 来编译 C# 文件时会定义 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"WINDOWS_UWP"},{"Type":"NodeText","Data":"。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_WINRT"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"与 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_WSA"},{"Type":"NodeText","Data":" 相同。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_WINRT_10_0"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"等效于 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_WSA_10_0"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_WEBGL"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于 WebGL 的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_FACEBOOK"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于 Facebook 平台（WebGL 或 Windows 独立平台）的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_ADS"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于从游戏代码中调用 Unity Ads 方法的 #define 指令。5.2 及更高版本。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_ANALYTICS"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于从游戏代码中调用 Unity Analytics 方法的 #define 指令。5.2 及更高版本。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_ASSERTIONS"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于断言控制过程的 #define 指令。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UNITY_64"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用于 64 位平台的 #define 指令。"}]}]}]},{"ID":"20240324193308-yc4b17q","Type":"NodeParagraph","Properties":{"id":"20240324193308-yc4b17q","updated":"20240324192758"},"Children":[{"Type":"NodeText","Data":"取自："},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://docs.unity.cn/cn/2019.4/Manual/PlatformDependentCompilation.html","TextMarkTextContent":"平台相关的编译 - Unity 手册"},{"Type":"NodeText","Data":"（2019.4版）"}]},{"ID":"20240324191730-sy30msi","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240324191730-sy30msi","updated":"20240615164942"},"Children":[{"Type":"NodeText","Data":"目标"}]},{"ID":"20240324191948-gjwprv4","Type":"NodeParagraph","Properties":{"id":"20240324191948-gjwprv4","updated":"20240324192009"},"Children":[{"Type":"NodeText","Data":"在客户端热更新逻辑路径进行相关进行修改"}]},{"ID":"20240324192011-tn5257u","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240324192011-tn5257u","updated":"20240324192036"},"Children":[{"ID":"20240324192012-i99pvfp","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240324192012-i99pvfp","updated":"20240324192012"},"Children":[{"ID":"20240324192012-4zoxomo","Type":"NodeParagraph","Properties":{"id":"20240324192012-4zoxomo","updated":"20240324192022"},"Children":[{"Type":"NodeText","Data":"下载AB包路径，按平台划分"}]}]},{"ID":"20240324192022-z36ott6","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240324192022-z36ott6","updated":"20240324192036"},"Children":[{"ID":"20240324192022-yri8t6n","Type":"NodeParagraph","Properties":{"id":"20240324192022-yri8t6n","updated":"20240324192036"},"Children":[{"Type":"NodeText","Data":"加载文件时，路径前缀处理"}]}]}]},{"ID":"20240324194052-60wwfw6","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240324194052-60wwfw6","updated":"20240615164942"},"Children":[{"Type":"NodeText","Data":"代码的修改"}]},{"ID":"20240324194055-jcewres","Type":"NodeParagraph","Properties":{"id":"20240324194055-jcewres","updated":"20240324200231"},"Children":[{"Type":"NodeText","Data":"我们需要修改以下几处地方"}]},{"ID":"20240324200232-rmsr3nz","Type":"NodeList","ListData":{},"Properties":{"id":"20240324200232-rmsr3nz","updated":"20240615164942"},"Children":[{"ID":"20240324200232-pwdtgwz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240324200232-pwdtgwz","updated":"20240324200232"},"Children":[{"ID":"20240324200232-cwa8o7s","Type":"NodeParagraph","Properties":{"id":"20240324200232-cwa8o7s","updated":"20240324200319"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"DownLoadFile"},{"Type":"NodeText","Data":"​内："}]},{"ID":"20240324200324-pwjojyv","Type":"NodeParagraph","Properties":{"id":"20240324200324-pwjojyv","updated":"20240324200350"},"Children":[{"Type":"NodeText","Data":"我们需要根据不同平台，修改下载资源的地址"}]},{"ID":"20240324200345-fdtm59u","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240324200345-fdtm59u","style":"line-height: 22px;","updated":"20240324200401"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YyM="},{"Type":"NodeCodeBlockCode","Data":"public bool DownLoadFile(string fileName, string localPath)\n{\n    try\n    {\n#if UNITY_IOS\n        string pInfo = \"IOS\";\n#elif UNITY_ANDROID\n        string pInfo = \"Android\";\n#else\n        string pInfo = \"PC\";\n#endif\n        //创建一个FTP连接 用于下载\n        FtpWebRequest request = FtpWebRequest.Create(new Uri($\"{serverIP}/AB/{pInfo}/\" + fileName)) as FtpWebRequest;\n        //设置通信凭证 这样才能下载（如果有匿名账号，可以不设置凭证，但是实际开发中建议不要设置匿名账号）\n        NetworkCredential credential = new NetworkCredential(\"MrTang\", \"MrTang123\");\n        request.Credentials = credential;\n        //其他设置：代理设置为null，请求完毕后关闭控制连接，操作命令设置为下载，指定传输二进制类型数据\n        request.Proxy = null;\n        request.KeepAlive = false;\n        request.Method = WebRequestMethods.Ftp.DownloadFile;\n        request.UseBinary = true;\n        FtpWebResponse response = request.GetResponse() as FtpWebResponse;\n        Stream downLoadStream = response.GetResponseStream();\n        using (FileStream file = File.Create(localPath))\n        {\n            byte[] bytes = new byte[2048];\n            int contentLength = downLoadStream.Read(bytes, 0, bytes.Length);\n            while (contentLength \u003e 0)\n            {\n                file.Write(bytes, 0, contentLength);\n                contentLength = downLoadStream.Read(bytes, 0, bytes.Length);\n            }\n            file.Close();\n            downLoadStream.Close();\n        }\n        return true;\n    }\n    catch (Exception e)\n    {\n        Debug.Log($\"{fileName}下载失败：{e.Message}\");\n        return false;\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240324200319-gg7zt0f","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240324200319-gg7zt0f","updated":"20240615164942"},"Children":[{"ID":"20240324200319-goqj1jt","Type":"NodeParagraph","Properties":{"id":"20240324200319-goqj1jt","updated":"20240324200551"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"GetLocalABCompareFileInfo"},{"Type":"NodeText","Data":"​内："}]},{"ID":"20240324200546-a3taosn","Type":"NodeParagraph","Properties":{"id":"20240324200546-a3taosn","updated":"20240324200720"},"Children":[{"Type":"NodeText","Data":"由于"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"GetLocalABCompareFileInfo"},{"Type":"NodeText","Data":"​协程方法内使用的是"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"UnityWebRequest"},{"Type":"NodeText","Data":"​读取的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Application.streamingAssetsPath"},{"Type":"NodeText","Data":"​\n因此我们需要对安卓平台的读取路径作特殊处理，也就是不加"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"file:///"},{"Type":"NodeText","Data":"​前缀，而其他平台就需要加上"}]},{"ID":"20240324200522-6qvn5ie","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240324200522-6qvn5ie","style":"line-height: 22px;","updated":"20240615164942"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YyM="},{"Type":"NodeCodeBlockCode","Data":"public void GetLocalABCompareFileInfo(UnityAction\u003cbool\u003e overCallBack)\n{\n    //如果可读可写文件夹内存在对比文件，说明之前我们已经下载过了\n    if (File.Exists(\"file:///\" + Application.persistentDataPath + \"/ABCompareInfo.txt\"))\n    {\n        StartCoroutine(GetLocalABCompareFileInfo(\"file:///\" + Application.persistentDataPath + \"/ABCompareInfo.txt\", overCal\n    }\n    //当可读可写文件夹内不存在对比文件时，才来加载默认的可读可写文件（第一次进游戏才会发生）\n    else if (File.Exists(Application.streamingAssetsPath + \"/ABCompareInfo.txt\"))\n    {\n#if UNITY_ANDROID\n        string path = Application.streamingAssetsPath;\n#else\n        string path = \"file:///\" + Application.streamingAssetsPath;\n#endif\n        StartCoroutine(GetLocalABCompareFileInfo(path + \"/ABCompareInfo.txt\", overCallBack));\n    }\n    //如果两个都不进，证明第一次并且无默认资源\n    else\n        overCallBack(false);\n}\n\n//本地AB包加载并解析\nprivate IEnumerator GetLocalABCompareFileInfo(string filePath, UnityAction\u003cbool\u003e overCallBack)\n{\n    UnityWebRequest request = UnityWebRequest.Get(filePath);\n    yield return request.SendWebRequest();\n    //获取文件成功，解析本地的资源解析\n    if (request.result == UnityWebRequest.Result.Success)\n    {\n        GetRemoteABCompareFileInfo(request.downloadHandler.text, localABInfo);\n        overCallBack(true);\n    }\n    else\n        overCallBack(false);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240324200419-2gemql3","Type":"NodeParagraph","Properties":{"id":"20240324200419-2gemql3"}}]}