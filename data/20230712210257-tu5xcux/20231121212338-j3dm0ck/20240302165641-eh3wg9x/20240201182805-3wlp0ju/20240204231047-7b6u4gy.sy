{"ID":"20240204231047-7b6u4gy","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240204231047-7b6u4gy","title":"UH2S2L21——第一个热补丁","updated":"20240319231714"},"Children":[{"ID":"20240205153951-refoecj","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240205153951-refoecj","updated":"20240205153958"},"Children":[{"Type":"NodeText","Data":"本章代码关键字"}]},{"ID":"20240205153958-5267q8d","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240205153958-5267q8d","style":"line-height: 22px;","updated":"20240205154116"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bHVh"},{"Type":"NodeCodeBlockCode","Data":"xlua.hotfix()\t--该方法可以用于对类的一个或多个方法进行热补丁替换操作，它使得调用方法时不再执行C#脚本内逻辑，而是Lua脚本逻辑\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240204231047-7wyp3rk","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240204231047-7wyp3rk","updated":"20240205141712"},"Children":[{"Type":"NodeText","Data":"xLua热补丁原理"}]},{"ID":"20240204231151-dzgai8d","Type":"NodeParagraph","Properties":{"id":"20240204231151-dzgai8d","updated":"20240205145914"},"Children":[{"Type":"NodeText","Data":"假设我们的游戏项目游戏逻辑目前全是用C"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"#"}]},{"Type":"NodeText","Data":"编写的，此时我们想要使用Lua来做热更新基本是要推翻重写的\n而xLua提供了一种热补丁功能，可通过打补丁的形式，使得我们代码逻辑不再走C"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"#"}]},{"Type":"NodeText","Data":"脚本的逻辑，而是Lua代码的逻辑\n这时我们再对Lua脚本执行热更新即可达到代码热更新的目的"}]},{"ID":"20240205142132-7xaima0","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240205142132-7xaima0","name":"xlua.hotfix()","updated":"20240205143106"},"Children":[{"Type":"NodeText","Data":"xLua热补丁"}]},{"ID":"20240205143335-obnxw3s","Type":"NodeParagraph","Properties":{"id":"20240205143335-obnxw3s","updated":"20240205143418"},"Children":[{"Type":"NodeText","Data":"假设我们要对下面类的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Add"},{"Type":"NodeText","Data":"​方法和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Speak"},{"Type":"NodeText","Data":"​方法做热补丁"}]},{"ID":"20240205143312-tp7vt9w","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240205143312-tp7vt9w","style":"line-height: 22px;","updated":"20240205143106"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YyM="},{"Type":"NodeCodeBlockCode","Data":"public class HotfixMain : MonoBehaviour\n{\n    public int Add(int a, int b)\n    {\n        return 0;\n    }\n\n    public static void Speak(string s)\n    {\n        Debug.Log(\"C# Speak\");\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240205143106-8i5xza7","Type":"NodeParagraph","Properties":{"id":"20240205143106-8i5xza7","updated":"20240205163529"},"Children":[{"Type":"NodeText","Data":"lua当中，热补丁代码固定写法："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"xlua.hotfix(类, \u0026quot;函数名\u0026quot;, lua函数)"},{"Type":"NodeText","Data":"​\n需要注意的是对成员方法打热补丁，lua函数的第一个参数必须为"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"self"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"self"},{"Type":"NodeText","Data":"​用于方法内调用对象自身内容，后面在接参数列表参数\n静态方法就不需要"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"self"},{"Type":"NodeText","Data":"​参数"}]},{"ID":"20240205143120-9z69ofo","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240205143120-9z69ofo","style":"line-height: 22px;","updated":"20240319231714"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bHVh"},{"Type":"NodeCodeBlockCode","Data":"--成员函数 第一个参数 self\nxlua.hotfix(CS.HotfixMain, \"Add\", function(self, a, b)\n\treturn a + b\nend\n\n--静态函数 不用传第一个参数\nxlua.hotfix(CS.HotfixMain, \"Speak\", function(a)\n\tprint(a)\nend\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240205143835-dyjuras","Type":"NodeParagraph","Properties":{"id":"20240205143835-dyjuras","updated":"20240205145348"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);"},"TextMarkType":"strong text","TextMarkTextContent":"要注意！"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);\"}"}]},{"ID":"20240205145354-44ci209","Type":"NodeList","ListData":{},"Properties":{"id":"20240205145354-44ci209","updated":"20240205161428"},"Children":[{"ID":"20240205145355-5pj6f9c","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240205145355-5pj6f9c","updated":"20240205145423"},"Children":[{"ID":"20240205145355-24vokjg","Type":"NodeParagraph","Properties":{"id":"20240205145355-24vokjg","updated":"20240205145423"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);"},"TextMarkType":"text strong","TextMarkTextContent":"仅仅以上操作并没有完成打热补丁的操作！此时直接执行是会报错的，我们必须继续做如下的操作！"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);\"}"}]}]},{"ID":"20240205145355-1i2vgc5","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240205145355-1i2vgc5","updated":"20240205161339"},"Children":[{"ID":"20240205145355-8bwahr7","Type":"NodeParagraph","Properties":{"id":"20240205145355-8bwahr7","updated":"20240205161339"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);"},"TextMarkType":"text","TextMarkTextContent":"如果修改了C#脚本中"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);\"}"},{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);"},"TextMarkType":"strong text","TextMarkTextContent":"修改了打热补丁的类的代码"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);\"}"},{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);"},"TextMarkType":"text","TextMarkTextContent":"，我们就需要"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);\"}"},{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);"},"TextMarkType":"text strong","TextMarkTextContent":"重新执行第四步操作！"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);\"}"}]}]},{"ID":"20240205161219-4o25f9t","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240205161219-4o25f9t","updated":"20240205161428"},"Children":[{"ID":"20240205161219-1o9gm6z","Type":"NodeParagraph","Properties":{"id":"20240205161219-1o9gm6z","updated":"20240205161428"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);"},"TextMarkType":"text","TextMarkTextContent":"如果在C#脚本中打热补丁的类"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);\"}"},{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);"},"TextMarkType":"strong text","TextMarkTextContent":"添加了方法"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);\"}"},{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);"},"TextMarkType":"text","TextMarkTextContent":"，或者"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);\"}"},{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);"},"TextMarkType":"text strong","TextMarkTextContent":"添加了新的需要打热补丁的类"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);\"}"},{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);"},"TextMarkType":"text","TextMarkTextContent":"，则必须"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);\"}"},{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);"},"TextMarkType":"text strong","TextMarkTextContent":"重新执行第三步和第四步操作！"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);\"}"}]}]}]},{"ID":"20240205143929-ktc4pn7","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240205143929-ktc4pn7","updated":"20240205161509"},"Children":[{"ID":"20240205144013-1wa3n8a","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240205144013-1wa3n8a","updated":"20240205145158"},"Children":[{"ID":"20240205144013-pnfe8yx","Type":"NodeParagraph","Properties":{"id":"20240205144013-pnfe8yx","updated":"20240205144106"},"Children":[{"Type":"NodeText","Data":"加特性，为需要打热补丁的类，添加"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"[Hotfix]"},{"Type":"NodeText","Data":"​​特性"}]},{"ID":"20240205145143-96du9tw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240205145143-96du9tw","style":"line-height: 22px;","updated":"20240205145158"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YyM="},{"Type":"NodeCodeBlockCode","Data":"[Hotfix]\npublic class HotfixMain : MonoBehaviour\n{\n\t//...\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240205144013-2f7q3bv","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240205144013-2f7q3bv","updated":"20240205144428"},"Children":[{"ID":"20240205144013-cg8ofur","Type":"NodeParagraph","Properties":{"id":"20240205144013-cg8ofur","updated":"20240205144110"},"Children":[{"Type":"NodeText","Data":"加宏，第一次开发热补丁需要加"}]},{"ID":"20240205144428-i83zbzz","Type":"NodeParagraph","Properties":{"id":"20240205144428-i83zbzz","updated":"20240205144428"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"width: 824px;","style":"width: 814px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240205144427-lanbkl5.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 814px;\" parent-style=\"width: 824px;\"}"}]},{"ID":"20240205154555-b5zu8b0","Type":"NodeParagraph","Properties":{"id":"20240205154555-b5zu8b0","updated":"20240205154556"},"Children":[{"Type":"NodeText","Data":"之后XLua选项内会多出一个注入热修复到编辑器（Hotfix Inject In Editor） 选项"}]}]},{"ID":"20240205144013-gs9vc2d","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240205144013-gs9vc2d","updated":"20240205161509"},"Children":[{"ID":"20240205144013-ztr8e8y","Type":"NodeParagraph","Properties":{"id":"20240205144013-ztr8e8y","updated":"20240205161509"},"Children":[{"Type":"NodeText","Data":"生成代码 （XLua - Generate Code），"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"每次为需要热补丁替换的类添加了特性或者为热补丁替换的类添加了方法都必须要重新执行这一步"}]}]},{"ID":"20240205144013-6y932j5","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20240205144013-6y932j5","updated":"20240205154745"},"Children":[{"ID":"20240205144013-ntkolnv","Type":"NodeParagraph","Properties":{"id":"20240205144013-ntkolnv","updated":"20240205154745"},"Children":[{"Type":"NodeText","Data":"hotfix 注入（Hotfix Inject In Editor），"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"每次修改了热补丁替换的类的代码就必须要重新执行这一步"},{"Type":"NodeText","Data":"，注入时可能报错，提示你要引入Tools"}]},{"ID":"20240205144658-h9adbbu","Type":"NodeParagraph","Properties":{"id":"20240205144658-h9adbbu","updated":"20240205145047"},"Children":[{"Type":"NodeText","Data":"如果提示需要引入Tools，你需要打开你下载的xlua-master文件夹，复制其中的Tool文件夹，导入到工程文件夹内（不是Assets文件夹下！）"}]},{"ID":"20240205145026-dwb9bm8","Type":"NodeParagraph","Properties":{"id":"20240205145026-dwb9bm8","updated":"20240205145026"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"width: 821px;","style":"width: 811px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240205145026-o77m103.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 811px;\" parent-style=\"width: 821px;\"}"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20240205145109-nt5pl5h","Type":"NodeParagraph","Properties":{"id":"20240205145109-nt5pl5h","updated":"20240205145121"},"Children":[{"Type":"NodeText","Data":"以上步骤完成，应该会输出如下信息："}]},{"ID":"20240205145122-d1tkkui","Type":"NodeParagraph","Properties":{"id":"20240205145122-d1tkkui","updated":"20240205145122"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240205145122-l741tnt.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]}]}